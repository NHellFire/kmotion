var KM={};KM.RED="#FF0000",KM.YELLOW="#FFFF00",KM.GREEN="#00FF00",KM.BLUE="#0000FF",KM.BLACK="#000000",KM.BAR="#9696FF",KM.WHITE="#FFFFFF",KM.GREY="#C1C1C1",KM.DARK_GREY="#818181",KM.GHOST="#E2E2E2",KM.BUTTON_BAR=0,KM.ERROR_DAEMON=1,KM.GET_DATA=2,KM.FEED_CACHE=3,KM.DISPLAY_LOOP=4,KM.ARCH_LOOP=5,KM.LOGS=6,KM.CONFIG_LOOP=7,KM.server={latest_jpegs:[],latest_events:[],feed_caches:[],servo_state:0},KM.browser={browser_FF:!1,browser_IE:!1,browser_OP:!1,browser_SP:!1,main_display_width:0,main_display_height:0},KM.session_id={current:0},KM.menu_bar_buttons={function_selected:0,display_sec_enabled:!1,camera_sec_enabled:!1,func_sec_enabled:!1,ptz_sec_enabled:!1},KM.live={last_camera_select:0,ptz_feed:0},KM.config={session_id:0,pwd_change:!1,camera:0,mask:"",ptz_current_x:0,ptz_current_y:0,error_str:"",error_search_str:/failed|error/i},KM.www_rc={feed_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_show_box:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_mask:["pad","","","","","","","","","","","","","","","",""],feed_device:["pad","","","","","","","","","","","","","","","",""],feed_url:["pad","","","","","","","","","","","","","","","",""],feed_proxy:["pad","","","","","","","","","","","","","","","",""],feed_lgn_name:["pad","","","","","","","","","","","","","","","",""],feed_lgn_pw:["pad","","","","","","","","","","","","","","","",""],feed_name:["pad","","","","","","","","","","","","","","","",""],feed_input:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_width:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_height:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_snap_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_smovie_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_movie_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_updates:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],feed_snap_interval:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_fps:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_quality:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],feed_kbs:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],ptz_calib_first:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],ptz_servo_settle:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_step_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_step_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],ptz_track_type:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_delay:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_park_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset1_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset1_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset2_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset2_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset3_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset3_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset4_x:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],ptz_preset4_y:["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],display_cameras:[],interleave:!1,full_screen:!1,low_bandwidth:!1,low_cpu:!1,skip_frames:!1,archive_button_enabled:!0,logs_button_enabled:!0,config_button_enabled:!0,func_button_enabled:!0,msg_button_enabled:!0,about_button_enabled:!0,logout_button_enabled:!0,func_enabled:["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],secure:!0,display_select:1,color_select:1,config_hash:"",version:"",version_latest:"",msg:""},KM.www_rc.display_cameras[1]=["pad",0],KM.www_rc.display_cameras[2]=["pad",0,0,0],KM.www_rc.display_cameras[3]=["pad",0,0,0,0,0,0,0,0,0],KM.www_rc.display_cameras[4]=["pad",0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],KM.www_rc.display_cameras[5]=["pad",0,0,0,0,0,0],KM.www_rc.display_cameras[6]=["pad",0,0,0,0,0,0,0,0,0,0,0,0,0],KM.www_rc.display_cameras[7]=["pad",0,0,0,0,0,0,0,0],KM.www_rc.display_cameras[8]=["pad",0,0,0,0,0,0,0,0,0,0],KM.www_rc.display_cameras[9]=["pad",0,0],KM.www_rc.display_cameras[10]=["pad",0,0],KM.www_rc.display_cameras[11]=["pad",0,0],KM.www_rc.display_cameras[12]=["pad",0,0],KM.timeout_ids=function(){var a=[];for(var b=0;b<8;b++)a[b]=[];return{add_id:function(b,c){a[b][a[b].length]=c},cull_ids:function(b){if(a[b].length>1){for(var c=0;c<a[b].length-1;c++)clearTimeout(a[b][c]),delete a[b][c];a[b].length=1}},kill_ids:function(b){if(a[b].length>1){for(var c=0;c<a[b].length;c++)clearTimeout(a[b][c]),delete a[b][c];a[b].length=1}}}},KM.timeout=KM.timeout_ids(),KM.add_timeout_id=KM.timeout.add_id,KM.cull_timeout_ids=KM.timeout.cull_ids,KM.kill_timeout_ids=KM.timeout.kill_ids,KM.get_xmlHttp_obj=function(){var a=null;try{a=new XMLHttpRequest}catch(b){try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){a=new ActiveXObject("Microsoft.XMLHTTP")}}return a},KM.load_settings=function(a){function b(a){function e(){b.onreadystatechange=function(){if(b.readyState===4){b.onreadystatechange=null;var e=b.responseText;parseInt(e.substr(e.length-8),10)===e.length-13&&(d=!0,KM.kill_timeout_ids(KM.GET_DATA),c(e,a))}},b.open("GET","cgi_bin/xmlHttp_settings_rd.py?rnd="+(new Date).getTime(),!0),b.send(null)}function f(){d||(e(),KM.add_timeout_id(KM.GET_DATA,setTimeout(function(){f()},1500)))}var b=KM.get_xmlHttp_obj(),d=!1;f()}function c(a,b){KM.set_main_display_size();var c=navigator.userAgent.toLowerCase();KM.browser.browser_IE=c.search("msie")>-1,KM.browser.browser_FF=c.search("firefox")>-1,KM.browser.browser_OP=c.search("opera")>-1,KM.browser.browser_SP=c.search("iphone")>-1||c.search("ipod")>-1||c.search("android")>-1||c.search("ipad")>-1||c.search("iemobile")>-1||c.search("blackberry")>-1;var d=a.split("$"),e,f,g;for(var h=1;h<d.length;h++){e=d[h].split(":"),e[0].length>3?(f=e[0].substring(0,3),g=parseInt(e[0].substring(3),10)):(f=e[0],g="");var i=e[1];switch(f){case"ine":KM.www_rc.interleave=parseInt(i,10)===1;break;case"fse":KM.www_rc.full_screen=parseInt(i,10)===1;break;case"lbe":KM.www_rc.low_bandwidth=parseInt(i,10)===1;break;case"lce":KM.www_rc.low_cpu=parseInt(i,10)===1;break;case"skf":KM.www_rc.skip_frames=parseInt(i,10)===1;break;case"are":KM.www_rc.archive_button_enabled=parseInt(i,10)===1;break;case"lge":KM.www_rc.logs_button_enabled=parseInt(i,10)===1;break;case"coe":KM.www_rc.config_button_enabled=parseInt(i,10)===1;break;case"fue":KM.www_rc.func_button_enabled=parseInt(i,10)===1;break;case"spa":KM.www_rc.msg_button_enabled=parseInt(i,10)===1;break;case"abe":KM.www_rc.about_button_enabled=parseInt(i,10)===1;break;case"loe":KM.www_rc.logout_button_enabled=parseInt(i,10)===1;break;case"fne":KM.www_rc.func_enabled[g]=parseInt(i,10)===1;break;case"sec":KM.www_rc.secure=parseInt(i,10)===1;break;case"coh":KM.www_rc.config_hash=i;break;case"fma":KM.www_rc.feed_mask[g]=i;break;case"fen":KM.www_rc.feed_enabled[g]=parseInt(i,10)===1;break;case"fde":KM.www_rc.feed_device[g]=i;break;case"fin":KM.www_rc.feed_input[g]=parseInt(i,10);break;case"ful":KM.www_rc.feed_url[g]=KM.collapse_chars(i);break;case"fpr":KM.www_rc.feed_proxy[g]=KM.collapse_chars(i);break;case"fln":KM.www_rc.feed_lgn_name[g]=KM.collapse_chars(i);break;case"flp":KM.www_rc.feed_lgn_pw[g]=KM.collapse_chars(i);break;case"fwd":KM.www_rc.feed_width[g]=parseInt(i,10);break;case"fhe":KM.www_rc.feed_height[g]=parseInt(i,10);break;case"fna":KM.www_rc.feed_name[g]=KM.collapse_chars(i);break;case"fbo":KM.www_rc.feed_show_box[g]=parseInt(i,10)===1;break;case"ffp":KM.www_rc.feed_fps[g]=parseInt(i,10);break;case"fqu":KM.www_rc.feed_quality[g]=parseInt(i,10);break;case"fkb":KM.www_rc.feed_kbs[g]=parseInt(i,10);break;case"fpe":KM.www_rc.feed_snap_enabled[g]=parseInt(i,10)===1;break;case"fsn":KM.www_rc.feed_snap_interval[g]=parseInt(i,10);break;case"ffe":KM.www_rc.feed_smovie_enabled[g]=parseInt(i,10)===1;break;case"fme":KM.www_rc.feed_movie_enabled[g]=parseInt(i,10)===1;break;case"fup":KM.www_rc.feed_updates[g]=parseInt(i,10)===1;break;case"psx":KM.www_rc.ptz_step_x[g]=parseInt(i,10);break;case"psy":KM.www_rc.ptz_step_y[g]=parseInt(i,10);break;case"ptt":KM.www_rc.ptz_track_type[g]=parseInt(i,10);break;case"pte":KM.www_rc.ptz_enabled[g]=parseInt(i,10)===1;break;case"ptc":KM.www_rc.ptz_calib_first[g]=parseInt(i,10)===1;break;case"pts":KM.www_rc.ptz_servo_settle[g]=parseFloat(i,10);break;case"ppe":KM.www_rc.ptz_park_enabled[g]=parseInt(i,10)===1;break;case"ppd":KM.www_rc.ptz_park_delay[g]=parseInt(i,10);break;case"ppx":KM.www_rc.ptz_park_x[g]=parseInt(i,10);break;case"ppy":KM.www_rc.ptz_park_y[g]=parseInt(i,10);break;case"p1x":KM.www_rc.ptz_preset1_x[g]=parseInt(i,10);break;case"p1y":KM.www_rc.ptz_preset1_y[g]=parseInt(i,10);break;case"p2x":KM.www_rc.ptz_preset2_x[g]=parseInt(i,10);break;case"p2y":KM.www_rc.ptz_preset2_y[g]=parseInt(i,10);break;case"p3x":KM.www_rc.ptz_preset3_x[g]=parseInt(i,10);break;case"p3y":KM.www_rc.ptz_preset3_y[g]=parseInt(i,10);break;case"p4x":KM.www_rc.ptz_preset4_x[g]=parseInt(i,10);break;case"p4y":KM.www_rc.ptz_preset4_y[g]=parseInt(i,10);break;case"dif":var j=i.split(",");for(var k=0;k<j.length;k++)KM.www_rc.display_cameras[g][k+1]=parseInt(j[k],10);break;case"col":KM.www_rc.color_select=parseInt(i,10);break;case"dis":KM.www_rc.display_select=parseInt(i,10);break;case"ver":KM.www_rc.version=i,document.getElementById("version_num").innerHTML="Ver "+i;break;case"vel":KM.www_rc.version_latest=i;break;case"msg":KM.www_rc.msg=KM.collapse_chars(i)}}b()}b(a)},KM.set_main_display_size=function(){var a,b;typeof window.innerWidth!="undefined"?(a=window.innerWidth,b=window.innerHeight):typeof document.documentElement!="undefined"&&typeof document.documentElement.clientWidth!="undefined"&&document.documentElement.clientWidth!==0?(a=document.documentElement.clientWidth,b=document.documentElement.clientHeight):(a=document.getElementsByTagName("body")[0].clientWidth,b=document.getElementsByTagName("body")[0].clientHeight),KM.browser.main_display_width=a-183,KM.browser.main_display_height=b-16},KM.exe_script=function(a,b){var c=KM.get_xmlHttp_obj();c.open("GET",a+"?val="+b+"&rnd="+(new Date).getTime(),!0),c.send(null)},KM.secs_hhmmss=function(a){var b=parseInt(a/3600,10),c=parseInt((a-b*60*60)/60,10),d=parseInt(a-b*60*60-c*60,10);return KM.pad_out2(b)+KM.pad_out2(c)+KM.pad_out2(d)},KM.secs_hh_mm_ss=function(a){var b=parseInt(a/3600,10),c=parseInt((a-b*60*60)/60,10),d=parseInt(a-b*60*60-c*60,10);return KM.pad_out2(b)+":"+KM.pad_out2(c)+":"+KM.pad_out2(d)},KM.expand_chars=function(a){return a=a.replace(/&/g,"<amp>"),a=a.replace(/\?/g,"<que>"),a=a.replace(/:/g,"<col>"),a},KM.collapse_chars=function(a){return a=a.replace(/<amp>/g,"&"),a=a.replace(/<que>/g,"?"),a=a.replace(/<col>/g,":"),a},KM.item_in_array=function(a,b){str_item=a.toString();for(var c=0;c<b.length;c++)if(b[c].toString()===str_item)return!0;return!1},KM.pad_out=function(a,b){var c="00000000000000000000";return String(a).length<b&&(a=c.substr(0,b-String(a).length)+String(a)),String(a)},KM.pad_out2=function(a){return KM.pad_out(a,2)},KM.pad_out4=function(a){return KM.pad_out(a,4)},KM.pad_out6=function(a){return KM.pad_out(a,6)},KM.do_nothing=function(){},KM.enable_display_buttons=function(a){KM.cull_timeout_ids(KM.BUTTON_BAR);for(var b=1;b<13;b++)b===a?document.getElementById("d"+b).src="images/r"+b+".png":document.getElementById("d"+b).src="images/b"+b+".png";KM.menu_bar_buttons.display_sec_enabled=!0},KM.update_display_buttons=KM.enable_display_buttons,KM.disable_display_buttons=function(){for(var a=1;a<13;a++)document.getElementById("d"+a).src="images/g"+a+".png";KM.menu_bar_buttons.display_sec_enabled=!1},KM.enable_camera_buttons=function(){document.getElementById("camera_func_header").innerHTML="Camera Select";for(var a=1;a<17;a++)document.getElementById("ct"+a).innerHTML=a,document.getElementById("cb"+a).style.background="url(images/temp1.png) no-repeat bottom left",KM.www_rc.feed_enabled[a]?document.getElementById("ct"+a).style.color=KM.BLUE:document.getElementById("ct"+a).style.color=KM.GREY;KM.menu_bar_buttons.camera_sec_enabled=!0,KM.menu_bar_buttons.func_sec_enabled=!1},KM.update_camera_buttons=KM.enable_camera_buttons,KM.disable_camera_buttons=function(){document.getElementById("camera_func_header").innerHTML="Camera Select";for(var a=1;a<17;a++)document.getElementById("cb"+a).style.background="url(images/temp1.png) no-repeat bottom left",document.getElementById("ct"+a).innerHTML=a,document.getElementById("ct"+a).style.color=KM.GREY;KM.menu_bar_buttons.camera_sec_enabled=!1,KM.menu_bar_buttons.func_sec_enabled=!1},KM.enable_func_buttons=function(){document.getElementById("camera_func_header").innerHTML="Function Select";for(var a=1;a<17;a++)document.getElementById("ct"+a).innerHTML="f"+a,document.getElementById("cb"+a).style.background="url(images/temp3.png) no-repeat bottom left",KM.www_rc.func_enabled[a]?document.getElementById("ct"+a).style.color=KM.BLUE:document.getElementById("ct"+a).style.color=KM.GREY;KM.menu_bar_buttons.camera_sec_enabled=!1,KM.menu_bar_buttons.func_sec_enabled=!0},KM.update_func_buttons=KM.enable_func_buttons,KM.disable_func_buttons=KM.disable_camera_buttons,KM.blink_camera_func_button=function(a){KM.menu_bar_buttons.camera_sec_enabled?(document.getElementById("ct"+a).style.color=KM.RED,KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.update_camera_buttons()},250))):KM.www_rc.func_enabled[a]&&(document.getElementById("ct"+a).style.color=KM.RED,KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.update_func_buttons()},250)))},KM.enable_ptz_buttons=function(){if(KM.menu_bar_buttons.function_selected===1){KM.menu_bar_buttons.ptz_sec_enabled=!1,KM.www_rc.ptz_enabled[KM.www_rc.display_cameras[1][1]]&&KM.www_rc.display_select===1?(KM.live.ptz_feed=KM.www_rc.display_cameras[1][1],KM.menu_bar_buttons.ptz_sec_enabled=!0):KM.www_rc.ptz_enabled[KM.live.last_camera_select]&&KM.live.last_camera_select!==0&&(KM.live.ptz_feed=KM.live.last_camera_select,KM.menu_bar_buttons.ptz_sec_enabled=!0);for(var a=1;a<5;a++)KM.menu_bar_buttons.ptz_sec_enabled?document.getElementById("p"+a).style.color=KM.BLUE:document.getElementById("p"+a).style.color=KM.GREY}},KM.update_ptz_buttons=KM.enable_ptz_buttons,KM.ptz_button_lockdown=function(a){KM.menu_bar_buttons.ptz_sec_enabled=!1,document.getElementById("p"+a).style.color=KM.RED,KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.disable_ptz_buttons()},250))},KM.disable_ptz_buttons=function(){for(var a=1;a<5;a++)document.getElementById("p"+a).style.color=KM.GREY;KM.menu_bar_buttons.ptz_sec_enabled=!1},KM.enable_function_buttons=function(a){var b=["pad","pad","archive_button_enabled","logs_button_enabled","config_button_enabled","func_button_enabled","about_button_enabled","msg_button_enabled","logout_button_enabled"];for(var c=1;c<b.length;c++)KM.www_rc[b[c]]||c===1?c===a?(c===5&&(document.getElementById("fb5").style.background="url(images/temp4.png) no-repeat bottom left"),document.getElementById("ft"+c).style.color=KM.RED):(c===5&&(document.getElementById("fb5").style.background="url(images/temp2.png) no-repeat bottom left"),document.getElementById("ft"+c).style.color=KM.BLUE):document.getElementById("ft"+c).style.color=KM.GREY},KM.update_function_buttons=KM.enable_function_buttons,KM.display_button_clicked=function(a){KM.menu_bar_buttons.display_sec_enabled&&(KM.update_display_buttons(a),KM.www_rc.display_select=a,KM.live.last_camera_select=0,KM.update_ptz_buttons(),KM.www_rc.full_screen?KM.display_live_full():KM.display_live_normal())},KM.camera_func_button_clicked=function(a){if(KM.menu_bar_buttons.camera_sec_enabled||KM.menu_bar_buttons.func_sec_enabled)KM.blink_camera_func_button(a),KM.menu_bar_buttons.camera_sec_enabled?(KM.live.last_camera_select=a,KM.update_ptz_buttons(),KM.www_rc.display_select===1&&(KM.www_rc.display_cameras[1][1]=a,KM.live.last_camera_select=0,KM.update_ptz_buttons(),KM.www_rc.full_screen?KM.display_live_full():KM.display_live_normal())):KM.exe_script("cgi_bin/xmlHttp_func.py",a)},KM.ptz_button_clicked=function(a){KM.menu_bar_buttons.ptz_sec_enabled&&(KM.ptz_button_lockdown(a),KM.exe_script("cgi_bin/xmlHttp_ptz.py","crf"+KM.pad_out2(KM.live.ptz_feed)+"b"+KM.pad_out2(a)+"$"))},KM.function_button_clicked=function(a){if(KM.function_button_valid(a)){KM.update_function_buttons(a),KM.menu_bar_buttons.function_selected=a;switch(a){case 1:KM.enable_display_buttons(KM.www_rc.display_select),KM.enable_camera_buttons(),KM.enable_ptz_buttons(),KM.www_rc.full_screen?KM.display_live_full():KM.display_live_normal();break;case 2:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.display_archive();break;case 3:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.display_logs();break;case 4:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.display_config();break;case 5:KM.disable_display_buttons(),KM.enable_func_buttons(),KM.disable_ptz_buttons();break;case 6:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.display_about();break;case 7:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.display_msg();break;case 8:KM.disable_display_buttons(),KM.disable_camera_buttons(),KM.disable_ptz_buttons(),KM.logout_button_clicked()}}},KM.function_button_valid=function(a){var b=["pad","pad","archive_button_enabled","logs_button_enabled","pad","func_button_enabled","about_button_enabled","msg_button_enabled","logout_button_enabled"];return a<2||a===4||KM.www_rc[b[a]]},KM.logout_button_clicked=function(){function c(){var e=b.toString(16);a.style.color="#"+e+e+e,b+=2,b<255?setTimeout(c,20):d()}function d(){var e=b.toString(16);a.style.color="#"+e+e+e,b-=2,b>193?setTimeout(d,20):setTimeout(c,400)}if(!window.confirm("Please confirm you wish to Logout")){KM.enable_select_buttons(),KM.update_function_buttons(1);return}KM.session_id.current++,document.getElementById("whole_display").innerHTML='<div id="info_high_line"><div id="info_text"><span class="italic">kmotion</span> logout<br><span id="info_small_text">For security reasons please shut down your browser now.</span></div></div>';var a=document.getElementById("info_small_text"),b=193;setTimeout(c,2e3)},KM.background_button_clicked=function(a){switch(a){case 1:document.body.style.backgroundImage="url(images/white.png)";break;case 2:document.body.style.backgroundImage="url(images/blue.png)";break;case 3:document.body.style.backgroundImage="url(images/green.png)";break;case 4:document.body.style.backgroundImage="url(images/yellow.png)";break;case 5:document.body.style.backgroundImage="url(images/red.png)"}document.body.style.backgroundRepeat="repeat-x",KM.www_rc.color_select=a},KM.update_feeds=function(){var a=KM.get_xmlHttp_obj();a.onreadystatechange=function(){if(a.readyState===4){a.onreadystatechange=null;var b=a.responseText;KM.server.latest_jpegs=b.split("#"),KM.server.servo_state=KM.server.latest_jpegs[17];if(KM.server.latest_jpegs[18]!==undefined){var c=KM.server.latest_jpegs[18].split("$");c.sort(),KM.server.latest_events=c}}},a.open("GET","cgi_bin/xmlHttp_feeds.py?rnd="+(new Date).getTime(),!0),a.send(null)},KM.feed_cache=function(a){var b=!0,c=!1,d=[],e=0,f=0,g="",h="",i=0,j=0,k=0;for(var l=0;l<5;l++)d[l]=new Image;return{get_jpeg:function(j,l){KM.cull_timeout_ids(KM.FEED_CACHE),e++,e=e>4?0:e,h=KM.server.latest_jpegs[a];if(h===""||h===undefined){KM.update_feeds(),KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){j("null",a,c,l)},1));return}if(g===h){KM.update_feeds(),KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){j(h,a,b,l)},100));return}g=h,d[e].onerror=function(){KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){j("null",a,c,l)},1))},d[e].onload=function(){KM.kill_timeout_ids(KM.FEED_CACHE);var b=new Date;i=b.getTime();var d=0;k!==KM.server.servo_state&&(d=KM.www_rc.ptz_servo_settle[a]*1e3+1,KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.enable_ptz_buttons()},d)),KM.add_timeout_id(KM.BUTTON_BAR,setTimeout(function(){KM.conf_ptz_ungrey_LUDR()},d)),k=KM.server.servo_state),d=1;if(KM.www_rc.low_cpu){b=(new Date).getTime();var e=KM.browser.browser_SP?1e3:200;d=Math.max(e-(b-f),1),f=b}KM.add_timeout_id(KM.FEED_CACHE,setTimeout(function(){j(h,a,c,l)},d))},KM.update_feeds(),d[e].src=h},check_jpeg_20sec_cache:function(){var a=new Date,b=a.getTime()-i;return b<2e4&&h!==""&&h!==undefined?h:"null"}}},KM.feed_cache_setup=function(){for(var a=1;a<17;a++)KM.server.feed_caches[a]=KM.feed_cache(a)},KM.get_jpeg=function(a,b,c){KM.server.feed_caches[a].get_jpeg(b,c)},KM.check_jpeg_20sec_cache=function(a){return KM.server.feed_caches[a].check_jpeg_20sec_cache()},KM.init_display_grid=function(a){function i(){g="",h=0}function j(){document.getElementById("main_display").innerHTML=g}function k(a,b,c,d,e,f,i,j){h++;var k="images/gcam.png",l="images/bcam.png";f===!0&&(k="images/gcam_alt.png",l="images/bcam_alt.png"),typeof i=="undefined"&&(i=10),typeof j=="undefined"&&(j=10);var m=k,n="No Video",o=KM.WHITE,p=KM.www_rc.display_cameras[a][h];if(KM.www_rc.feed_enabled[p]){m=l;var q=KM.check_jpeg_20sec_cache(p);q!=="null"&&(m=q),o=KM.BLUE,KM.item_in_array(p,KM.server.latest_events)&&(o=KM.RED),n=KM.www_rc.feed_name[p]}n=p+" : "+n;var r='<img id="image_'+h+'" ',s='style="position:absolute; ',t="left:"+b+"px; ",u="top:"+c+"px; ",v="width:"+d+"px; ",w="height:"+e+'px;" ',x='src="'+m+'"; ',y='onClick="KM.camera_jpeg_clicked('+h+')"; ',z='alt="">';g=g+r+s+t+u+v+w+x+y+z;var A='<span id="text_'+h+'"; ',B='style="position:absolute; ',C="left:"+(b+i)+"px; ",D="top:"+(c+j)+"px;",E="font-weight: bold;",F="color:"+o+";",G='">'+n+"</span>";g=g+A+B+C+D+E+F+G}function l(){var a=KM.browser.main_display_width-b*2,g=KM.browser.main_display_height-b*2;a/g<1.33?g=a*.75:a=g*1.33,c=(KM.browser.main_display_width-a)/2,d=b,e=a,f=g}function m(a){l();var g,h,i,j,m,n,o,p;switch(a){case 1:i=1,j=1,o=(e-b*(j-1))/j,p=(f-b*(i-1))/i;for(g=0;g<i;g++)for(h=0;h<j;h++)k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 2:i=2,j=2,o=(e-b*(j-1))/j,p=(f-b*(i-1))/i;for(g=0;g<i;g++)for(h=0;h<j;h++)k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 3:i=3,j=3,o=(e-b*(j-1))/j,p=(f-b*(i-1))/i;for(g=0;g<i;g++)for(h=0;h<j;h++)k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 4:i=4,j=4,o=(e-b*(j-1))/j,p=(f-b*(i-1))/i;for(g=0;g<i;g++)for(h=0;h<j;h++)k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 5:i=[0,1,2,2,2],j=[2,2,0,1,2],o=(e-b*2)/3,p=(f-b*2)/3,k(a,c,d,o*2+b,p*2+b);for(var q=0;q<5;q++)g=i[q],h=j[q],k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 6:i=[0,0,1,1,2,2,2,2,3,3,3,3],j=[2,3,2,3,0,1,2,3,0,1,2,3],o=(e-b*3)/4,p=(f-b*3)/4,k(a,c,d,o*2+b,p*2+b);for(q=0;q<12;q++)g=i[q],h=j[q],k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 7:i=[0,1,2,3,3,3,3],j=[3,3,3,0,1,2,3],o=(e-b*3)/4,p=(f-b*3)/4,k(a,c,d,o*3+b*2,p*3+b*2);for(q=0;q<7;q++)g=i[q],h=j[q],k(a,c+h*(o+b),d+g*(p+b),o,p);break;case 8:i=[0,0,1,1,2,2,3,3],j=[2,3,2,3,0,1,0,1],o=(e-b*3)/4,p=(f-b*3)/4,k(a,c,d,o*2+b,p*2+b);for(q=0;q<8;q++)g=i[q],h=j[q],k(a,c+h*(o+b),d+g*(p+b),o,p);k(a,c+o*2+b*2,d+p*2+b*2,o*2+b,p*2+b);break;case 9:o=e,p=f,m=o*.28,n=p*.28,k(a,c,d,o,p,!1,o*.02+m+10,p*.02+10),k(a,c+o*.02,d+p*.02,m,n,!0);break;case 10:o=e,p=f,m=o*.28,n=p*.28,k(a,c,d,o,p,!1,o*.02+10,p*.02+10),k(a,c+o-m-o*.02,d+p*.02,m,n,!0);break;case 11:o=e,p=f,m=o*.28,n=p*.28,k(a,c,d,o,p,!1,o*.02+10,p*.02+10),k(a,c+o*.02,d+p-n-p*.02,m,n,!0);break;case 12:o=e,p=f,m=o*.28,n=p*.28,k(a,c,d,o,p,!1,o*.02+10,p*.02+10),k(a,c+o-m-o*.02,d+p-n-p*.02,m,n,!0)}}var b=3,c=0,d=0,e=0,f=0,g="",h=0;i(),m(a),j()},KM.initial_display_refresh=function(a,b){function i(){e++;if(e<d){var f=KM.www_rc.display_cameras[KM.www_rc.display_select][e];if(KM.www_rc.feed_enabled[f]&&!KM.item_in_array(f,c)){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(f,j,b)},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){i()},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){a(b)},1))}function j(a,b,c,d){if(d!==KM.session_id.current)return;KM.update_feeds(),a!=="null"&&(document.getElementById("image_"+e).src=a),KM.text_refresh(),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){i()},1))}var c=[],d=KM.www_rc.display_cameras[KM.www_rc.display_select].length,e=0;KM.update_feeds();var f,g;for(var h=1;h<d;h++)f=KM.www_rc.display_cameras[KM.www_rc.display_select][h],g=KM.check_jpeg_20sec_cache(f),KM.www_rc.feed_enabled[f]&&g!=="null"&&(c[c.length]=f);KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){i()},1))},KM.text_refresh=function(){var a=KM.www_rc.display_cameras[KM.www_rc.display_select].length,b,c;for(i=1;i<a;i++)c=KM.WHITE,b=KM.www_rc.display_cameras[KM.www_rc.display_select][i],KM.www_rc.feed_enabled[b]&&(c=KM.BLUE,KM.item_in_array(b,KM.server.latest_events)&&(c=KM.RED)),document.getElementById("text_"+i).style.color=c},KM.camera_jpeg_clicked=function(a){KM.live.last_camera_select!==0?(KM.www_rc.display_cameras[KM.www_rc.display_select][a]=KM.live.last_camera_select,KM.live.last_camera_select=0):(KM.www_rc.display_cameras[1][1]=KM.www_rc.display_cameras[KM.www_rc.display_select][a],KM.www_rc.display_select=1,KM.update_display_buttons(1),KM.update_ptz_buttons()),KM.www_rc.full_screen?KM.display_live_full():KM.display_live_normal()},KM.display_live_normal=function(){function d(a){function m(){while(a===KM.session_id.current){KM.kill_timeout_ids(KM.DISPLAY_LOOP);if(j||!KM.www_rc.interleave){if(KM.www_rc.low_bandwidth){c=new Date;if(c.getTime()-d<9e5){KM.text_refresh(),j=!1,e=1e3,KM.server.latest_events.length>1&&(e=1),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},e));return}}i++;if(i<b){var k=KM.www_rc.display_cameras[KM.www_rc.display_select][i];if(KM.www_rc.feed_enabled[k]&&(!KM.item_in_array(k,f)||!KM.www_rc.interleave)&&!KM.item_in_array(k,h)){j=!1,h[h.length]=k,KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(k,n,a)},1));return}j=!1;continue}i=0,h.length=0,c=new Date,d=c.getTime();continue}if(g<f.length){var k=f[g];g++;if(KM.item_in_array(k,KM.www_rc.display_cameras[KM.www_rc.display_select])){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(k,n,a)},1));return}continue}f=KM.server.latest_events,g=1,j=!0;continue}}function n(a,c,d,e){if(e!==KM.session_id.current)return;if(a==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1));return}if(d){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1));return}l++,l=l>4?0:l,k[l]=a;for(var f=1;f<b;f++)KM.www_rc.display_cameras[KM.www_rc.display_select][f]===c&&(document.getElementById("image_"+f).src=k[l]);KM.text_refresh(),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){m()},1))}var b=KM.www_rc.display_cameras[KM.www_rc.display_select].length,c=new Date,d=c.getTime(),e,f=[],g=1,h=[],i=0,j=!0,k=["","","","",""],l=0;m()}KM.session_id.current++,KM.set_main_display_size(),KM.init_display_grid(KM.www_rc.display_select);var a=!0;for(var b=1;b<KM.www_rc.display_cameras[KM.www_rc.display_select].length;b++)KM.www_rc.feed_enabled[KM.www_rc.display_cameras[KM.www_rc.display_select][b]]&&(a=!1);if(a)return;var c=d;KM.initial_display_refresh(c,KM.session_id.current)},KM.display_live_full=function(){function d(a){function n(){KM.session_id.current++,h=KM.session_id.current,KM.enable_display_buttons(KM.www_rc.display_select),KM.enable_camera_buttons(),KM.init_display_grid(KM.www_rc.display_select);var a=o;KM.initial_display_refresh(a,KM.session_id.current)}function o(){if(h!==KM.session_id.current)return;KM.kill_timeout_ids(KM.DISPLAY_LOOP),f=KM.server.latest_events;if(f.length>1){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){q()},1));return}if(KM.www_rc.low_bandwidth){c=new Date;if(c.getTime()-d<9e5){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1e3));return}}k++;if(k<b){var a=KM.www_rc.display_cameras[KM.www_rc.display_select][k];if(KM.www_rc.feed_enabled[a]&&!KM.item_in_array(a,j)){j[j.length]=a,KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(a,p,h)},1));return}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1));return}k=0,j.length=0,c=new Date,d=c.getTime(),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1))}function p(a,c,d,e){if(e!==KM.session_id.current)return;KM.update_feeds();if(a==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1));return}if(d){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1));return}m++,m=m>4?0:m,l[m]=a;for(var f=1;f<b;f++)KM.www_rc.display_cameras[KM.www_rc.display_select][f]===c&&(document.getElementById("image_"+f).src=l[m]);KM.text_refresh(),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){o()},1))}function q(){KM.session_id.current++,i=KM.session_id.current,KM.disable_display_buttons(),KM.disable_camera_buttons(),g=1,t(f[g]),c=new Date,e=c.getTime(),KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},1))}function r(){if(i!==KM.session_id.current)return;KM.kill_timeout_ids(KM.DISPLAY_LOOP);if(f.length===1){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){n()},1));return}c=new Date,c.getTime()-e>5e3&&(e=c.getTime(),g++);if(g<f.length){var a=f[g];KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){KM.get_jpeg(a,s,i)},1));return}f=KM.server.latest_events,g=1,KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},1))}function s(a,b,c,d){if(d!==KM.session_id.current)return;if(a==="null"){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},1));return}if(c){KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},200));return}m++,m=m>4?0:m,l[m]=a,document.getElementById("image_1").src=l[m];var e=KM.www_rc.feed_name[b];document.getElementById("text_1").innerHTML=b+" : "+e,KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){r()},1))}function t(a){var b=3,c="",d=e,e="images/bcam.png",f=KM.browser.main_display_width-b*2,g=KM.browser.main_display_height-b*2;f/g<1.33?g=f*.75:f=g*1.33;var h=(KM.browser.main_display_width-f)/2,i=b,j=f,k=g,l=KM.www_rc.feed_name[a];l=a+" : "+l;var m='<img id="image_1" ',n='style="position:absolute; ',o="left:"+h+"px; ",p="top:"+i+"px; ",q="width:"+j+"px; ",r="height:"+k+'px;" ',s='src="images/bcam.png";',t='alt="">';c=c+m+n+o+p+q+r+s+t;var u='<span id="text_1"; ',v='style="position:absolute; ',w="left:"+(h+10)+"px; ",x="top:"+(i+10)+"px;",y="font-weight: bold;",z="color:"+KM.RED,A='">'+l+"</span>";c=c+u+v+w+x+y+z+A,document.getElementById("main_display").innerHTML=c}var b=KM.www_rc.display_cameras[KM.www_rc.display_select].length,c=new Date,d=c.getTime(),e=0,f=[],g=0,h=a,i=0,j=[],k=0,l=["","","","",""],m=0;o()}KM.set_main_display_size(),KM.session_id.current++,KM.init_display_grid(KM.www_rc.display_select);var a=!0;for(var b=1;b<KM.www_rc.display_cameras[KM.www_rc.display_select].length;b++)KM.www_rc.feed_enabled[KM.www_rc.display_cameras[KM.www_rc.display_select][b]]&&(a=!1);if(a)return;var c=d;KM.initial_display_refresh(c,KM.session_id.current)},KM.display_archive_=function(){function Q(){KM.session_id.current++;var a=KM.session_id.current;KM.set_main_display_size(),U();var b=R;bF(b,a)}function R(a){if(d.length===0)html='<div class="archive_msg" style="text-align: center"><br><br>',html+="There are currently no recorded events or snapshots to display.<br><br>",html+="To enable event recording select either 'frame mode' or ",html+="'movie mode'<br>in the camera configuration ",html+="section and edit the motion mask.<br><br>",html+="To enable snapshot recording select 'snapshot mode' in the camera<br>",html+="configuration section</div>",document.getElementById("display_html").innerHTML=html;else{bf(),V(),W(),bc(),document.getElementById("date_select").disabled=!1,document.getElementById("camera_select").disabled=!1,document.getElementById("view_select").disabled=!1,document.getElementById("mode_select").disabled=!1;var b=S;bG(b,d[document.getElementById("date_select").selectedIndex],e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],a)}}function S(){X(),T()}function T(){bc(),bf(),bg();var a=d[document.getElementById("date_select").selectedIndex],b=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];Z(a,b),Y()}function U(){L=KM.browser.main_display_width-6,K=KM.browser.main_display_height-6-151,L/K<1.33?K=L*.75:L=K*1.33;var a=(KM.browser.main_display_width-L)/2,b=L/4,c=L/5,d="archive_title_FF";KM.browser.browser_OP&&(d="archive_title_OP"),KM.browser.browser_IE&&(d="archive_title_IE"),document.getElementById("main_display").innerHTML='<div id="'+d+'" style="width:'+L+'px;">'+'<span class="italic">kmotion</span>: Archive '+'<span id="config_clock"> - </span>'+"</div>"+'<div class="divider">'+'<img src="images/archive_divider.png" style="width:'+L+'px;" alt="" />'+"</div>"+'<div id="config_bar" class="archive_bar">'+'<form name="config" action="" onsubmit="return false">'+'<select id="date_select" OnChange="KM.arch_change_date();" style="width:'+b+'px;" disabled >'+"<option>----/--/--</option>"+"</select>"+'<select id="camera_select" OnChange="KM.arch_change_camera();" style="width:'+b+'px;" disabled>'+"<option>-:</option>"+"</select>"+'<select id="view_select" OnChange="KM.arch_change_view();" style="width:'+b+'px;" disabled >'+"<option>-</option>"+"</select>"+'<select id="mode_select" OnChange="KM.arch_change_mode();" style="width:'+b+'px;" disabled >'+"<option>Event mode</option>"+"<option>Display mode</option>"+"</select>"+"</form>"+"</div>"+'<div id="display_html" class="archive_backdrop" style="width:'+L+"px;height:"+K+'px;">'+"</div>"+'<div class="archive_bar">'+'<input type="button" id="bar_button1" style="width:'+c+'px;" OnClick="KM.arch_bar_button_clicked(1);" value="-" disabled>'+'<input type="button" id="bar_button2" style="width:'+c+'px;" OnClick="KM.arch_bar_button_clicked(2);" value="-" disabled>'+'<input type="button" id="bar_button3" style="width:'+c+'px;" OnClick="KM.arch_bar_button_clicked(3);" value="-" disabled>'+'<input type="button" id="bar_button4" style="width:'+c+'px;" OnClick="KM.arch_bar_button_clicked(4);" value="-" disabled>'+'<input type="button" id="bar_button5" style="width:'+c+'px;" OnClick="KM.arch_bar_button_clicked(5);" value="-" disabled>'+"</div>"+'<div id="timeline" class="archive_timeline" style="width:'+L+'px;">'+"</div>";var e="",f=0,g=0,h=0,i=0,j="",k=288,l=L/k,m=0;for(var n=1;n<k+1;n++)f=Math.round(n*l),f=Math.min(L,f),m=f-g,g=f,h=(n-1)*5,i=parseInt(h/60),h-=i*60,j=KM.pad_out2(i)+":"+KM.pad_out2(h),e+='<img id="tslot_'+n+'" src="./images/tline_g0.png" style="width:'+m+'px;height:30px;" onClick="KM.arch_tline_clicked('+(n-1)*5*60+')" title="'+j+'" alt="timeline">';document.getElementById("timeline").innerHTML=e,show_downloading_msg()}function V(){var a=document.getElementById("date_select");for(var b=a.options.length-1;b>-1;b--)a.remove(b);var c="",e="";for(var b=0;b<d.length;b++){c=document.createElement("option"),e=d[b],c.text=e.slice(0,4)+" / "+e.slice(4,6)+" / "+e.slice(6);try{a.add(c,null)}catch(f){a.add(c)}new_obj=null,document.getElementById("date_select").selectedIndex=0}}function W(){var a=document.getElementById("camera_select");for(var b=a.options.length-1;b>-1;b--)a.remove(b);var c=document.getElementById("date_select").selectedIndex,d="";for(var b=0;b<e[c].length;b++){d=document.createElement("option"),d.text=KM.pad_out2(e[c][b])+" : "+f[c][b];try{a.add(d,null)}catch(g){a.add(d)}new_obj=null,document.getElementById("camera_select").selectedIndex=0}}function X(){var d=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],f=document.getElementById("view_select");for(var i=f.options.length-1;i>-1;i--)f.remove(i);var j=g[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],l=h[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],m=k[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];j&&l&&(B[B.length-1]>=u[u.length-1]?j=!1:l=!1);var n=[];n[0]="No filter",(j||l)&&m&&(n[1]="Filter event movies",n[2]="Filter snapshots");for(var i=0;i<n.length;i++){new_opt=document.createElement("option"),new_opt.text=n[i];try{f.add(new_opt,null)}catch(o){f.add(new_opt)}}new_obj=null,document.getElementById("view_select").selectedIndex=0,a=j,b=l,c=m}function Y(){function j(a,b){var c=99999,d=-1,e=-1;for(var f=G.length-1;f>-1;f--){H[f]!==0&&(e=d,d=f);if(G[f]<=a){if(H[f]===0){d!==-1&&(c=G[d]);break}var g=a-G[f],h=g/H[f];h=parseInt(h,10)+1,c=G[f]+parseInt(h,10)*H[f],G[Math.min(f+1,G.length)]<=c&&(c=G[e]);break}}return c===99999&&d!==-1&&(c=G[d]),c<=b}function k(a,b){var c=0;for(var d=0;d<t.length;d++)t[d]<=b&&u[d]>=a&&(c+=Math.min(u[d],b)-Math.max(t[d],a));return c}function l(a,b){var c=0,d=0;for(var e=0;e<z.length;e++)z[e]<=b&&B[e]>=a&&(c=Math.min(B[e],b),d+=c-z[e]);return d}var d=300,e=50,f=0,g="",h=0;for(var i=1;i<289;i++)g="./images/tline_g0.png",c&&j((i-1)*d,i*d)&&(g="./images/tline_b1.png"),b?(h=0,f=l((i-1)*d,i*d-1),f>e*5?h=6:f>e*4?h=5:f>e*3?h=4:f>e*2?h=3:f>e?h=2:f>0&&(h=1),h!==0&&(g="./images/tline_r"+h+".png")):a&&(h=0,f=k((i-1)*d,i*d-1),f>e*5?h=6:f>e*4?h=5:f>e*3?h=4:f>e*2?h=3:f>e?h=2:f>0&&(h=1),h!==0&&(g="./images/tline_r"+h+".png")),document.getElementById("tslot_"+i).src=g;I=-1}function Z(c,d){function j(a,b){var c=[];for(var d=0;d<a.length;d++)c[d]=b[d]-a[d];c=c.sort(function(a,b){return a-b});var e=Math.max(1,parseInt(c.length/10,10));return c.splice(c.length-e,e)}var e="",f="",g=0;if(a){var h=j(t,u);for(var i=0;i<t.length;i++)f='onclick="KM.arch_event_clicked('+t[i]+')"',g=u[i]-t[i],KM.item_in_array(g,h)&&(f+=' style="color:#D90000"'),e+="<span "+f+">",e+="&nbsp;Movie event&nbsp;&nbsp;",e+=KM.secs_hh_mm_ss(t[i]),e+="&nbsp;&nbsp;-&nbsp;&nbsp;",e+=KM.secs_hh_mm_ss(u[i]),e+="&nbsp;&nbsp;duration&nbsp;&nbsp;",e+=KM.pad_out4(g),e+="&nbsp;&nbsp;secs&nbsp;&nbsp ... &nbsp;&nbsp;click to view<br>",e+="</span>"}else if(b){var h=j(z,B);for(var i=0;i<z.length;i++)f='onclick="KM.arch_event_clicked('+z[i]+')"',g=B[i]-z[i],KM.item_in_array(g,h)&&(f+=' style="color:#D90000"'),e+="<span "+f+">",e+="&nbsp;Frame movie event&nbsp;&nbsp;",e+=KM.secs_hh_mm_ss(z[i]),e+="&nbsp;&nbsp;-&nbsp;&nbsp;",e+=KM.secs_hh_mm_ss(B[i]),e+="&nbsp;&nbsp;duration&nbsp;&nbsp;",e+=KM.pad_out4(g),e+="&nbsp;&nbsp;secs&nbsp;&nbsp ... &nbsp;&nbsp;click to view<br>",e+="</span>"}e.length===0&&(e+='<div class="archive_msg" style="text-align: center"><br><br>',e+="There are currently no recorded events to display.<br><br>",e+="To enable event recording select either 'frame mode' or ",e+="'movie mode'<br>in the camera configuration ",e+="section and edit the motion mask.<br><br>To display ",e+="snapshot images select 'Display mode'.</div>"),document.getElementById("display_html").innerHTML=e}function $(){KM.session_id.current++;var a=KM.session_id.current;bl(),show_downloading_msg(),W();var b=S;bG(b,d[document.getElementById("date_select").selectedIndex],e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],a)}function _(){KM.session_id.current++;var a=KM.session_id.current;bl(),show_downloading_msg(),bc();var b=S;bG(b,d[document.getElementById("date_select").selectedIndex],e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],a)}function ba(){bl(),show_downloading_msg();var d=g[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],e=h[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],f=k[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];d&&e&&(d=!1);var i=document.getElementById("view_select").selectedIndex;a=d,b=e,c=f,i===1?c=!1:i===2&&(a=!1,b=!1),T()}function bb(){if(document.getElementById("mode_select").selectedIndex===0){KM.session_id.current++,l=!0,bf(),bn(),bg();var a=d[document.getElementById("date_select").selectedIndex],b=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];Z(a,b)}else l=!1,m=!0,q=4,bj(),bq(-1)}function bc(){l=!0,document.getElementById("mode_select").selectedIndex=0}function bd(){l=!1,document.getElementById("mode_select").selectedIndex=1}function be(a){var b=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],c=f[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],d=KM.secs_hh_mm_ss(a);document.getElementById("config_clock").innerHTML="("+KM.pad_out2(b)+":"+c+" "+d+")",b=null,c=null}function bf(){var a=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],b=f[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];document.getElementById("config_clock").innerHTML="("+KM.pad_out2(a)+":"+b+")",a=null,b=null}function bg(){for(var a=1;a<6;a++)document.getElementById("bar_button"+a).disabled=!0;document.getElementById("bar_button1").value="-",document.getElementById("bar_button2").value="-",document.getElementById("bar_button3").value="-",document.getElementById("bar_button4").value="-",document.getElementById("bar_button5").value="-"}function bh(){for(var a=1;a<6;a++)document.getElementById("bar_button"+a).disabled=!0}function bi(){for(var a=1;a<6;a++)document.getElementById("bar_button"+a).disabled=!1}function bj(){for(var a=1;a<6;a++)document.getElementById("bar_button"+a).disabled=!1;for(var a=1;a<6;a++)document.getElementById("bar_button"+a).style.color=KM.BLACK;var b=[["<<<<","<",">",">>"],["<<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>"],["<<","<",">",">>>"],["<<","<",">",">>>>"]],c=b[q];document.getElementById("bar_button1").value=c[0],document.getElementById("bar_button2").value=c[1],document.getElementById("bar_button3").value="Click for frames",document.getElementById("bar_button4").value=c[2],document.getElementById("bar_button5").value=c[3],q<3&&(document.getElementById("bar_button1").style.color=KM.RED),q===3&&(document.getElementById("bar_button2").style.color=KM.RED),q===4&&(document.getElementById("bar_button4").style.color=KM.RED),q>4&&(document.getElementById("bar_button5").style.color=KM.RED)}function bk(){for(var a=1;a<6;a++)document.getElementById("bar_button"+a).disabled=!1;for(var a=1;a<6;a++)document.getElementById("bar_button"+a).style.color=KM.BLACK;document.getElementById("bar_button1").value="-event",document.getElementById("bar_button2").value="-frame",document.getElementById("bar_button3").value="Click to play",document.getElementById("bar_button4").value="+frame",document.getElementById("bar_button5").value="+event"}function bl(){for(var a=1;a<289;a++)document.getElementById("tslot_"+a).src="./images/tline_g0.png"}function bm(a){var b=parseInt(a/300)+1;b!=I&&(I>-1&&(document.getElementById("tslot_"+I).src=J),I=b,J=document.getElementById("tslot_"+b).src,document.getElementById("tslot_"+b).src="./images/tline_y6.png")}function bn(){I>-1&&(document.getElementById("tslot_"+I).src=J)}function bo(a){var b=q;m?(a===1?(q>2?q=2:(q--,q=Math.max(0,q)),bj()):a===2?(q=3,bj()):a===3?(KM.session_id.current++,m=!1,bk()):a===4?(q=4,bj()):a===5&&(q<5?q=5:(q++,q=Math.min(7,q)),bj()),b>3&&q<4&&bv(),b<4&&q>3&&bq()):a===1?bz():a===2?(q=3,bv()):a===3?(m=!0,q=4,bj(),bq()):a===4?(q=4,bq()):a===5&&bu()}function bp(a){KM.session_id.current++,bd(),q=4,m=!0,bj(),bq(a)}function bq(f){function j(d){p=(new Date).getTime(),KM.kill_timeout_ids(KM.ARCH_LOOP);if(q>3){if(KM.www_rc.skip_frames&&q!==4)for(var e=0;e<d;e++){var f=bt(h,i);if(a){var j=br();if(j.valid&&(j.secs<=f.secs||!c||!f.valid)){o=j.secs,x=j.frame,y=j.index;continue}}else if(b){var m=bs(h,i);if(m.valid&&(m.secs<=f.secs||!c||!f.valid)){o=m.secs,E=m.frame,F=m.index;continue}}break}var r=bt(h,i);if(a){var t=br();if(t.valid&&(t.secs<=r.secs||!c||!r.valid)){var u=k;t.reset_html?(n=!1,bB(t,g,u)):bA(t,g,u);return}}else if(b){var v=bs(h,i);if(v.valid&&(v.secs<=r.secs||!c||!r.valid)){var u=l;display_smovie(v,g,u);return}}if(c&&r.valid){n||(bD(),n=!0);var u=s;bC(r,g,u);return}}}function k(a){a.frames!==undefined&&(w=a.frames),o=a.secs,x=a.frame,y=a.index,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=1e3/v[y]/r[q-4],d=c-b,e=0;d<0&&(e=-d/c,d=0);var d=Math.max(0,1e3/v[y]/r[q-4]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j(e)},d))}}function l(a){o=a.secs,E=a.frame,F=a.index,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=1e3/D[F]/r[q-4],d=c-b,e=0;d<0&&(e=-d/c,d=0);var d=Math.max(0,1e3/D[F]/r[q-4]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j(e)},d))}}function s(a){o=a.secs,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=Math.max(0,1e3/r[q-4]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j(0)},c))}}KM.session_id.current++;var g=KM.session_id.current;KM.kill_timeout_ids(KM.ARCH_LOOP),f!==undefined&&(o=f,bm(o),br("reset"),bs(0,0,"reset"),bD(),n=!0);var h=d[document.getElementById("date_select").selectedIndex],i=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];j()}function br(a){if(a==="reset")y=-1;else{if(y!==-1){var b=x+1;if(b<=w){var c=Math.round(b/w*(u[y]-t[y])+t[y]);return{valid:!0,frame:b,secs:c,index:y,reset_html:!1}}y=-1}for(var d=0;d<t.length;d++)if(t[d]<=o&&u[d]>o||t[d]>o)return{valid:!0,frame:1,secs:t[d],index:d,reset_html:!0};return{valid:!1,frame:0,secs:0,index:0,reset_html:!1}}}function bs(a,b,c){if(c==="reset")F=-1;else{if(F!==-1){var d=E+1,e=o;if(e===B[F]&&d===C[F])F=-1;else return d>=D[F]&&(d=0,e++),{valid:!0,frame:d,secs:e,index:F,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(e)+"/"+KM.pad_out2(d)+".jpg"}}for(var f=0;f<z.length;f++){if(z[f]<=o&&B[f]>o){var g=D[f]-1;return z[f]===o&&(g=D[f]-A[f]),{valid:!0,frame:D[f]-A[f],secs:o,index:f,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(o)+"/"+KM.pad_out2(g)+".jpg"}}if(z[f]>o)return{valid:!0,frame:D[f]-A[f],secs:z[f],index:f,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(z[f])+"/"+KM.pad_out2(D[f]-A[f])+".jpg"}}return{valid:!1,frame:0,secs:0,index:0,fq_image_name:""}}}function bt(a,b){var c=99999,d=-1,e=-1;for(var f=G.length-1;f>-1;f--){H[f]!==0&&(e=d,d=f);if(G[f]<=o){if(H[f]===0){d!==-1&&(c=G[d]);break}var g=o-G[f],h=g/H[f];h=parseInt(h,10)+1,c=G[f]+parseInt(h,10)*H[f],G[Math.min(f+1,G.length)]<=c&&(c=G[e]);break}}return c===99999&&d!==-1&&(c=G[d]),c<=86400?{valid:!0,secs:c,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/snap/"+KM.secs_hhmmss(c)+".jpg"}:{valid:!1,secs:0,fq_image_name:""}}function bu(){KM.session_id.current++;if(a){for(var c=0;c<t.length;c++)if(t[c]>o){bq(t[c]);break}}else if(b)for(var c=0;c<z.length;c++)if(z[c]>o){bq(z[c]);break}}function bv(f){function j(d){p=(new Date).getTime(),KM.kill_timeout_ids(KM.ARCH_LOOP);if(q<4){if(KM.www_rc.skip_frames&&q!==3)for(var e=0;e<d;e++){var f=by(h,i);if(a){var j=bw();if(j.valid&&(j.secs>=f.secs||!c||!f.valid)){o=j.secs,x=j.frame,y=j.index;continue}}else if(b){var m=bx(h,i);if(m.valid&&(m.secs>=f.secs||!c||!f.valid)){o=m.secs,E=m.frame,F=m.index;continue}}break}var r=by(h,i);if(a){var t=bw();if(t.valid&&(t.secs>=r.secs||!c||!r.valid)){var u=k;t.reset_html?(n=!1,bB(t,g,u)):bA(t,g,u);return}}else if(b){var v=bx(h,i);if(v.valid&&(v.secs>=r.secs||!c||!r.valid)){var u=l;display_smovie(v,g,u);return}}if(c&&r.valid){n||(bD(),n=!0);var u=s;bC(r,g,u)}}}function k(a){a.frames!==undefined&&(w=a.frames),x=a.frame,y=a.index,o=a.secs,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=1e3/v[y]/r[3-q],d=c-b,e=0;d<0&&(e=-d/c,d=0);var d=Math.max(0,1e3/v[y]/r[3-q]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j(e)},d))}}function l(a){o=a.secs,E=a.frame,F=a.index,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=1e3/v[F]/r[3-q],d=c-b,e=0;d<0&&(e=-d/c,d=0);var d=Math.max(0,1e3/D[F]/r[3-q]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j(e)},d))}}function s(a){o=a.secs,be(o),bm(o);if(m){var b=(new Date).getTime()-p,c=Math.max(0,1e3/r[3-q]-b);KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){j()},c))}}KM.session_id.current++;var g=KM.session_id.current;KM.kill_timeout_ids(KM.ARCH_LOOP),f!==undefined&&(o=f,bw("reset"),bx(0,0,"reset"),bD(),n=!0);var h=d[document.getElementById("date_select").selectedIndex],i=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex];j()}function bw(a){if(a==="reset")y=-1;else{if(y!==-1){var b=x-1;if(b>0){var c=Math.round(b/w*(u[y]-t[y])+t[y]);return{valid:!0,frame:b,secs:c,index:y,reset_html:!1}}y=-1}for(var d=t.length;d>-1;d--)if(t[d]<o&&u[d]>=o||u[d]<o)return{valid:!0,frame:9999,secs:u[d],index:d,reset_html:!0};return{valid:!1,frame:0,secs:0,index:0,reset_html:!1}}}function bx(a,b,c){if(c==="reset")F=-1;else{if(F!==-1){var d=E-1,e=o;if(e===z[F]&&d===D[F]-A[F]-1)F=-1;else return d<0&&(d=D[F]-1,e--),{valid:!0,frame:d,secs:e,index:F,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(e)+"/"+KM.pad_out2(d)+".jpg"}}for(var f=z.length;f>-1;f--){if(z[f]<o&&B[f]>=o){var g=D[f]-1;return B[f]===o&&(g=C[f]-1),{valid:!0,frame:g,secs:o,index:f,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(o)+"/"+KM.pad_out2(g)+".jpg"}}if(B[f]<o)return{valid:!0,frame:C[f]-1,secs:B[f],index:f,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/smovie/"+KM.secs_hhmmss(B[f])+"/"+KM.pad_out2(C[f]-1)+".jpg"}}return{valid:!1,frame:0,secs:0,index:0,fq_image_name:""}}}function by(a,b){var c=99999,d=o;for(var e=G.length-1;e>-1;e--)if(G[e]<d){if(H[e]===0){d=Math.max(0,G[e]-1);continue}var f=d-G[e],g=f/H[e];parseInt(g,10)===g?g=parseInt(g,10)-1:g=parseInt(g,10);var c=G[e]+g*H[e];break}return c<=86400?{valid:!0,secs:c,fq_image_name:"images_dbase/"+a+"/"+KM.pad_out2(b)+"/snap/"+KM.secs_hhmmss(c)+".jpg"}:{valid:!1,secs:0,fq_image_name:""}}function bz(){KM.session_id.current++;if(a){for(var c=t.length;c>-1;c--)if(u[c]<o){bq(t[c]);break}}else if(b)for(var c=z.length;c>-1;c--)if(B[c]<o){bq(z[c]);break}}function bA(a,b,c){b===KM.session_id.current&&(s.GotoFrame(a.frame),KM.cull_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){c(a)},1)))}function bB(a,b,c){function f(a,b){var c=d[document.getElementById("date_select").selectedIndex],f=e[document.getElementById("date_select").selectedIndex][document.getElementById("camera_select").selectedIndex],g="images_dbase/"+c+"/"+KM.pad_out2(f)+"/movie/"+KM.secs_hhmmss(t[a.index])+".swf";document.getElementById("display_html").innerHTML='<div id="movie"><div id="archive_flash_warn">Please enable a flash (.swf) compatible plugin.</div></div>',FlashReplace.replace("movie",g,"movie_id",L-5,K-5),s=document.getElementById("movie_id")}function g(a,b,c){if(s.PercentLoaded()===100){KM.browser.browser_IE?a.frames=s.TotalFrames:a.frames=s.TotalFrames();if(a.secs===t[a.index])s.GotoFrame(1),a.frame=1;else if(a.secs===u[a.index])s.GotoFrame(a.frames),a.frame=a.frames;else{var d=a.secs-t[a.index];a.frame=parseInt(a.frames*((u[a.index]-t[a.index])/d),10),s.GotoFrame(a.frame)}bi();var e=1e3/v[a.index]/r[q-4];b===KM.session_id.current&&(KM.cull_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){c(a)},e)))}else KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){g(a,b,c)},10))}f(a,b),b===KM.session_id.current&&(bh(),g(a,b,c))}function bC(a,b,c){function e(d){d&&(P++,P=P>3?0:P,O[P]=a.fq_image_name,b===KM.session_id.current&&(document.getElementById("image").src=O[P])),b===KM.session_id.current&&(KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){c(a)},1)))}var d=e;bE(a.fq_image_name,d)}function bD(){fq_image_name="images/ncam.png";var a="<img src="+fq_image_name+' id="image" style="width:100%;height:99%" alt="" />';document.getElementById("display_html").innerHTML=a}function bE(a,b){N++,N=N>3?0:N,KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){b(!1)},5e3)),M[N].onerror=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){b(!1)},1))},M[N].onload=function(){KM.kill_timeout_ids(KM.ARCH_LOOP),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){b(!0)},1))},M[N].src=a}function bF(a,b){function l(){var a=KM.get_xmlHttp_obj();a.onreadystatechange=function(){if(a.readyState===4){a.onreadystatechange=null;var d=a.responseText;parseInt(d.substr(d.length-8),10)===d.length-13&&KM.session_id.current===b&&(c=!0,n(d))}},a.open("GET","cgi_bin/xmlHttp_arch.py?date=00000000&cam=0&func=avail&rnd="+(new Date).getTime(),!0),a.send(null)}function m(){c||(l(),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){m()},2e3)))}function n(c){d.length=0,e.length=0,f.length=0,g.length=0,h.length=0,k.length=0;var l=c.split("$");for(i=0;i<l.length-2;i++){var m=l[i+1].split("#");d[i]=m[0],e[i]=[],f[i]=[],g[i]=[],h[i]=[],k[i]=[];var n=0;for(j=1;j<m.length-1;j+=5)e[i][n]=parseInt(m[j],10),g[i][n]=m[j+1]==="1",h[i][n]=m[j+2]==="1",k[i][n]=m[j+3]==="1",f[i][n]=m[j+4],n++}d.reverse(),e.reverse(),f.reverse(),g.reverse(),h.reverse(),k.reverse(),KM.kill_timeout_ids(KM.ARCH_LOOP),a(b)}var c=!1;m()}function bG(a,b,c,d){function f(){var a=KM.get_xmlHttp_obj();a.onreadystatechange=function(){if(a.readyState===4){a.onreadystatechange=null;var b=a.responseText;parseInt(b.substr(b.length-8),10)===b.length-13&&KM.session_id.current===d&&(e=!0,h(b))}},a.open("GET","cgi_bin/xmlHttp_arch.py?date="+b+"&cam="+c+"&func=index"+"&rnd="+(new Date).getTime(),!0),a.send(null)}function g(){e||(f(),KM.add_timeout_id(KM.ARCH_LOOP,setTimeout(function(){g()},2e3)))}function h(b){function i(a){return a=KM.pad_out6(a),hh=parseInt(a.slice(0,2),10),mm=parseInt(a.slice(2,4),10),ss=parseInt(a.slice(4,6),10),hh*60*60+mm*60+ss}G.length=0,H.length=0,t.length=0,u.length=0,v.length=0,z.length=0,A.length=0,B.length=0,C.length=0,D.length=0;var c=b.split("@"),d=c[0].split("$"),e=c[1].split("$"),f=c[2].split("$");for(var g=0;g<d.length-1;g++){var h=d[g+1].split("#");t[g]=i(h[0]),v[g]=parseInt(h[1],10),u[g]=i(h[2])}for(var g=0;g<e.length-1;g++)h=e[g+1].split("#"),z[g]=i(h[0]),A[g]=parseInt(h[1],10),D[g]=parseInt(h[2],10),B[g]=i(h[3]),C[g]=parseInt(h[4],10);for(var g=0;g<f.length-2;g++)h=f[g+1].split("#"),G[g]=i(h[0]),H[g]=parseInt(h[1],10);KM.kill_timeout_ids(KM.ARCH_LOOP),a()}var e=!1;g()}var a=!1,b=!1,c=!1,d=[],e=[],f=[],g=[],h=[],k=[],l=!0,m=!0,n=!1,o=0,p=0,q=0,r=[1,2,5,10],s=0,t=[],u=[],v=[],w=0,x=0,y=0,z=[],A=[],B=[],C=[],D=[],E=0,F=0,G=[],H=[],I=-1,J="",K=0,L=0,M=[new Image,new Image,new Image,new Image],N=0,O=["","","",""],P=0;return show_downloading_msg=function(){document.getElementById("display_html").innerHTML='<br><div class="archive_msg" style="text-align: center">... downloading data ...</div>'},event_clicked=bp,display_smovie=bC,{init:Q,change_date:$,change_camera:_,change_view:ba,change_mode:bb,bar_button_clicked:bo,event_clicked:event_clicked,tline_clicked:bp}}(),KM.display_archive=KM.display_archive_.init,KM.arch_change_date=KM.display_archive_.change_date,KM.arch_change_camera=KM.display_archive_.change_camera,KM.arch_change_view=KM.display_archive_.change_view,KM.arch_change_mode=KM.display_archive_.change_mode,KM.arch_bar_button_clicked=KM.display_archive_.bar_button_clicked,KM.arch_event_clicked=KM.display_archive_.event_clicked,KM.arch_tline_clicked=KM.display_archive_.tline_clicked,KM.display_logs=function(){function c(a){var b=a.split("$");b.pop();var c="";for(var e=1;e<b.length;e++)b[e].indexOf("Incorrect")!==-1||b[e].indexOf("Deleting current")!==-1?c+='<span style="color:'+KM.RED+';">'+d(b[e])+"</span>":b[e].indexOf("Deleting")!==-1||b[e].indexOf("Initial")!==-1?c+='<span style="color:'+KM.BLUE+';">'+d(b[e])+"</span>":c+=d(b[e]);document.getElementById("logs_html").innerHTML=c}function d(a){return event_split=a.split("#"),"Date : "+event_split[0]+"&nbsp;&nbsp;Time : "+event_split[1]+"&nbsp;&nbsp;Event : "+event_split[2]+"<br>"}function f(){var b=KM.get_xmlHttp_obj();b.onreadystatechange=function(){if(b.readyState===4){b.onreadystatechange=null;var d=b.responseText;parseInt(d.substr(d.length-4),10)===d.length-8&&KM.session_id.current===a&&(e=!0,KM.cull_timeout_ids(KM.LOGS),c(d))}},b.open("GET","cgi_bin/xmlHttp_logs.py?rnd="+(new Date).getTime(),!0),b.send(null)}function g(){e||(f(),KM.add_timeout_id(KM.LOGS,setTimeout(function(){g()},1500)))}KM.session_id.current++;var a=KM.session_id.current,b="title_FF";KM.browser.browser_OP&&(b="title_OP"),KM.browser.browser_IE&&(b="title_IE"),document.getElementById("main_display").innerHTML='<div id="'+b+'">'+'<span class="italic">kmotion</span>: Logs'+"</div>"+'<div class="divider">'+'<img src="images/divider_xl.png" alt="" />'+"</div>"+'<div class="logs_backdrop" id="logs_html">'+'<p style="text-align: center">... downloading data ...</p>'+"</div>";var e=!1;g()},KM.conf_config_track=function(){function j(a){return a?1:0}var a=!1,b=!1,c=!1,d=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],f=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],g=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],h=!1,i="";return{misc_modified:function(){a=!0},pw_modified:function(){c=!0},display_modified:function(){b=!0},feed_modified:function(a){e[a]=!0,h=!0},mask_modified:function(a){d[a]=!0,h=!0},ptz_en_tt_modified:function(a){g[a]=!0,h=!0},ptz_misc_modified:function(a){f[a]=!0},reset:function(){a=!1,c=!1,d=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],e=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],f=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],g=["pad",!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1,!1],b=!1,h=!1,i=""},sync:function(){a&&(i+="$ine:"+j(KM.www_rc.interleave),i+="$fse:"+j(KM.www_rc.full_screen),i+="$lbe:"+j(KM.www_rc.low_bandwidth),i+="$lce:"+j(KM.www_rc.low_cpu),i+="$skf:"+j(KM.www_rc.skip_frames),i+="$are:"+j(KM.www_rc.archive_button_enabled),i+="$lge:"+j(KM.www_rc.logs_button_enabled),i+="$coe:"+j(KM.www_rc.config_button_enabled),i+="$fue:"+j(KM.www_rc.func_button_enabled),i+="$spa:"+j(KM.www_rc.msg_button_enabled),i+="$abe:"+j(KM.www_rc.about_button_enabled),i+="$loe:"+j(KM.www_rc.logout_button_enabled),i+="$sec:"+j(KM.www_rc.secure)),c&&(i+="$coh:"+KM.www_rc.config_hash);for(var k=1;k<17;k++)d[k]===!0&&(i+="$fma"+k+":"+KM.www_rc.feed_mask[KM.config.camera]);for(var k=1;k<17;k++)e[k]===!0&&(i+="$fen"+k+":"+j(KM.www_rc.feed_enabled[KM.config.camera]),i+="$fde"+k+":"+KM.www_rc.feed_device[KM.config.camera],i+="$fin"+k+":"+KM.www_rc.feed_input[KM.config.camera],i+="$ful"+k+":"+KM.expand_chars(KM.www_rc.feed_url[KM.config.camera]),i+="$fpr"+k+":"+KM.expand_chars(KM.www_rc.feed_proxy[KM.config.camera]),i+="$fln"+k+":"+KM.expand_chars(KM.www_rc.feed_lgn_name[KM.config.camera]),i+="$flp"+k+":"+KM.expand_chars(KM.www_rc.feed_lgn_pw[KM.config.camera]),i+="$fwd"+k+":"+KM.www_rc.feed_width[KM.config.camera],i+="$fhe"+k+":"+KM.www_rc.feed_height[KM.config.camera],i+="$fna"+k+":"+KM.expand_chars(KM.www_rc.feed_name[KM.config.camera]),i+="$fbo"+k+":"+j(KM.www_rc.feed_show_box[KM.config.camera]),i+="$ffp"+k+":"+KM.www_rc.feed_fps[KM.config.camera],i+="$fqu"+k+":"+KM.www_rc.feed_quality[KM.config.camera],i+="$fkb"+k+":"+KM.www_rc.feed_kbs[KM.config.camera],i+="$fpe"+k+":"+j(KM.www_rc.feed_snap_enabled[KM.config.camera]),i+="$fsn"+k+":"+KM.www_rc.feed_snap_interval[KM.config.camera],i+="$ffe"+k+":"+j(KM.www_rc.feed_smovie_enabled[KM.config.camera]),i+="$fme"+k+":"+j(KM.www_rc.feed_movie_enabled[KM.config.camera]),i+="$fup"+k+":"+j(KM.www_rc.feed_updates[KM.config.camera]));if(b){for(var k=1;k<13;k++)i+="$dif"+k+":"+KM.www_rc.display_cameras[k].slice(1,KM.www_rc.display_cameras[k].length);i+="$col:"+KM.www_rc.color_select,i+="$dis:"+KM.www_rc.display_select}for(var k=1;k<17;k++)g[k]===!0&&(i+="$pte"+k+":"+j(KM.www_rc.ptz_enabled[k]),i+="$ptt"+k+":"+KM.www_rc.ptz_track_type[k]);for(var k=1;k<17;k++)f[k]===!0&&(i+="$psx"+k+":"+KM.www_rc.ptz_step_x[k],i+="$psy"+k+":"+KM.www_rc.ptz_step_y[k],i+="$ptc"+k+":"+j(KM.www_rc.ptz_calib_first[k]),i+="$pts"+k+":"+KM.www_rc.ptz_servo_settle[k],i+="$ppe"+k+":"+j(KM.www_rc.ptz_park_enabled[k]),i+="$ppd"+k+":"+KM.www_rc.ptz_park_delay[k],i+="$ppx"+k+":"+KM.www_rc.ptz_park_x[k],i+="$ppy"+k+":"+KM.www_rc.ptz_park_y[k],i+="$p1x"+k+":"+KM.www_rc.ptz_preset1_x[k],i+="$p1y"+k+":"+KM.www_rc.ptz_preset1_y[k],i+="$p2x"+k+":"+KM.www_rc.ptz_preset2_x[k],i+="$p2y"+k+":"+KM.www_rc.ptz_preset2_y[k],i+="$p3x"+k+":"+KM.www_rc.ptz_preset3_x[k],i+="$p3y"+k+":"+KM.www_rc.ptz_preset3_y[k],i+="$p4x"+k+":"+KM.www_rc.ptz_preset4_x[k],i+="$p4y"+k+":"+KM.www_rc.ptz_preset4_y[k]);var l=i.length,m="00000000".substring(0,8-(l+"").length);i+="$chk:"+m+l;if(l!==0){var n=KM.get_xmlHttp_obj();n.open("POST","cgi_bin/xmlHttp_settings_wr.py"),n.setRequestHeader("Content-type","application/x-www-form-urlencoded"),n.setRequestHeader("Content-length",i.length),n.setRequestHeader("Connection","close"),n.send("dblob="+i)}h&&(alert("The current synchronisation with the remote server\ninvolves reloading of the motion daemon configuration.\n\nDuring the reload kmotion will experience temporary\nvideo freezing."),KM.conf_config_track.reset())}}}(),KM.conf_error_daemon=function(a){function b(){var b=KM.get_xmlHttp_obj();b.onreadystatechange=function(){if(b.readyState===4){b.onreadystatechange=null;var c=b.responseText;if(parseInt(c.substr(c.length-6),10)===c.length-10&&KM.session_id.current===a){KM.config.error_str=c.substr(0,c.length-10);var d=KM.config.error_str.split("\n"),e=!1;for(var f=0;f<d.length;f++)d[f].search(KM.config.error_search_str)!==-1&&(e=!0);e?KM.conf_highlight_error_button():KM.conf_disable_error_button()}}},b.open("GET","cgi_bin/xmlHttp_out.py?rnd="+(new Date).getTime(),!0),b.send(null)}function c(){b(),KM.session_id.current===a&&(KM.cull_timeout_ids(KM.ERROR_DAEMON),KM.add_timeout_id(KM.ERROR_DAEMON,setTimeout(function(){c()},1e3)))}KM.add_timeout_id(KM.ERROR_DAEMON,setTimeout(function(){c()},1))},KM.display_config=function(){KM.www_rc.secure?KM.conf_loggin_html():KM.conf_backdrop_html()},KM.conf_loggin_html=function(){KM.session_id.current++;var a="title_FF";KM.browser.browser_OP&&(a="title_OP"),KM.browser.browser_IE&&(a="title_IE"),document.getElementById("main_display").innerHTML='<div id="'+a+'">'+'<span class="italic">kmotion</span>: Config'+"</div>"+'<div class="divider">'+'<img src="images/divider_xl.png" alt="" />'+"</div><br>"+'<form  name="login" onSubmit="return false">'+'<div class="sub_title">'+"Password "+'<input type="password" name="password" size="20" />&nbsp;'+'<input type="button" OnClick="KM.conf_login_validate_pw();" value="Submit">'+"</div>"+"</form>",document.login.password.focus()},KM.conf_login_validate_pw=function(){KM.config_misc_hash_pw(document.login.password.value)===KM.www_rc.config_hash?KM.conf_backdrop_html():document.login.password.value=""},KM.conf_backdrop_html=function(){KM.session_id.current++;var a=197,b="title_FF";KM.browser.browser_OP&&(b="title_OP"),KM.browser.browser_IE&&(b="title_IE");var c="height:22px;";KM.browser.browser_FF&&(c=""),document.getElementById("main_display").innerHTML='<div id="'+b+'">'+'<span class="italic">kmotion</span>: Config'+"</div>"+'<div class="divider">'+'<img src="images/divider_xl.png" alt="" />'+"</div>"+'<div id="config_bar" class="config_bar">'+'<form name="config" action="" onsubmit="return false">'+'<select id="config_select" onchange="KM.conf_select_config();" onclick="KM.conf_select_config();" '+'style="width:'+a+"px; "+c+'">'+"<option>Misc Config</option>"+"<option>Camera 1</option>"+"<option>Camera 2</option>"+"<option>Camera 3</option>"+"<option>Camera 4</option>"+"<option>Camera 5</option>"+"<option>Camera 6</option>"+"<option>Camera 7</option>"+"<option>Camera 8</option>"+"<option>Camera 9</option>"+"<option>Camera 10</option>"+"<option>Camera 11</option>"+"<option>Camera 12</option>"+"<option>Camera 13</option>"+"<option>Camera 14</option>"+"<option>Camera 15</option>"+"<option>Camera 16</option>"+"</select>"+'<input type="button" value="PT(Z)" id="ptz_button" onclick="KM.conf_select_ptz()" '+'style="width:'+a+"px; "+c+'" disabled />'+'<input type="button" value="Motion Errors" id="error_button" onclick="KM.conf_select_errors();" '+'style="width:'+a+"px; "+c+'" disabled/>'+'<input type="button" value="Server Load" onclick="KM.conf_select_load();" '+'style="width:'+a+"px; "+c+'"/>'+"</form>"+"</div>"+'<div class="config_backdrop" id="config_html">'+"</div>",KM.conf_misc_html()},KM.conf_highlight_error_button=function(){document.getElementById("error_button").style.fontWeight="bold",document.getElementById("error_button").style.color=KM.RED,document.getElementById("error_button").disabled=!1},KM.conf_disable_error_button=function(){document.getElementById("error_button").style.fontWeight="normal",document.getElementById("error_button").style.color="#c6c7c9",document.getElementById("error_button").disabled=!0},KM.conf_select_config=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current),KM.config.camera=document.getElementById("config_select").selectedIndex,document.getElementById("ptz_button").disabled=!0,KM.config.camera===0?KM.conf_misc_html():KM.conf_feed_html(KM.config.camera)},KM.conf_select_ptz=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current),KM.conf_ptz_html()},KM.conf_select_errors=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current),KM.conf_error_html()},KM.conf_select_load=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current),KM.conf_load_html()},KM.conf_misc_html=function(){document.getElementById("config_html").innerHTML='<br><div class="config_button">Auto software check : <span id="misc_version"></span></div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_inter" onClick ="KM.conf_misc_highlight_apply();">Interleave mode. Gives preference to cameras where motion has been detected.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_full" onClick ="KM.conf_misc_force_inter();">Full screen mode. Changes to full screen mode when motion has been detected.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_low_bw" onClick ="KM.conf_misc_force_inter();">Low bandwidth mode. Update \'no motion\' cameras every 15 mins.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_low_cpu" onClick ="KM.conf_misc_highlight_apply();">Low CPU mode. Reduce browser CPU usage by capping update frequency.</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div style="float:left; width:45%;"><div class="margin_top_4px"><div class="config_tick_box"><input type="checkbox" id="misc_live" checked disabled>Live button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_logs" onClick ="KM.conf_misc_highlight_apply();">Logs button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_func" onClick ="KM.conf_misc_highlight_apply();">Func button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_msg" onClick ="KM.conf_misc_highlight_apply();">Msg button enabled.</div></div></div><div class="margin_top_4px"><div class="config_tick_box"><input type="checkbox" id="misc_archive" onClick ="KM.conf_misc_highlight_apply();">Archive button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_config" onClick ="KM.conf_misc_highlight_apply();">Config button enabled.</div><br><div class="config_tick_box"><input type="checkbox" id="misc_about" onClick ="KM.conf_misc_highlight_apply();">About button enabled.&nbsp;</div><br><div class="config_tick_box"><input type="checkbox" id="misc_logout" onClick ="KM.conf_misc_highlight_apply();">Logout button enabled.</div></div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_skip_frames" onClick ="KM.conf_misc_highlight_apply();">Enable archive playback acceleration by skipping frames. (may miss events)</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_save" onClick ="KM.conf_misc_save_display();">Save the current \'Display Select\' configuration and current style as defaults.</div><br><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_tick_box margin_top_4px"><input type="checkbox" id="misc_secure" onClick ="KM.conf_misc_highlight_apply();">Enable security login screen. New password : <input type="password" id="misc_pw" size="20" >&nbsp;<input type="button" onclick="KM.conf_misc_save_pw();" value="Submit"> </div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div class="config_button margin_top_4px" id="conf_text"><input type="button" id="conf_apply" OnClick="KM.conf_misc_apply();" value="Apply"> all changes to the local browser configuration and sync with the remote server.</div>';if(KM.www_rc.low_bandwidth||KM.www_rc.full_screen)KM.www_rc.interleave=!0,document.getElementById("misc_inter").checked=KM.www_rc.interleave,document.getElementById("misc_inter").disabled=!0;document.getElementById("misc_inter").checked=KM.www_rc.interleave,document.getElementById("misc_full").checked=KM.www_rc.full_screen,document.getElementById("misc_low_bw").checked=KM.www_rc.low_bandwidth,document.getElementById("misc_low_cpu").checked=KM.www_rc.low_cpu,document.getElementById("misc_skip_frames").checked=KM.www_rc.skip_frames,document.getElementById("misc_archive").checked=KM.www_rc.archive_button_enabled,document.getElementById("misc_logs").checked=KM.www_rc.logs_button_enabled,document.getElementById("misc_config").checked=KM.www_rc.config_button_enabled,document.getElementById("misc_func").checked=KM.www_rc.func_button_enabled,document.getElementById("misc_msg").checked=KM.www_rc.msg_button_enabled,document.getElementById("misc_about").checked=KM.www_rc.about_button_enabled,document.getElementById("misc_logout").checked=KM.www_rc.logout_button_enabled,document.getElementById("misc_secure").checked=KM.www_rc.secure,KM.www_rc.version_latest==="failed_parse"?(document.getElementById("misc_version").innerHTML="CONNECTING TO UPDATE SERVER ...",document.getElementById("misc_version").style.color=KM.YELLOW):KM.www_rc.version_latest==="SVN"?(document.getElementById("misc_version").innerHTML="SVN VERSION - SVN UPDATE FOR LATEST BUILD",document.getElementById("misc_version").style.color=KM.RED):KM.www_rc.version===KM.www_rc.version_latest?document.getElementById("misc_version").innerHTML="NO UPDATES AVALIABLE.":(document.getElementById("misc_version").innerHTML="VERSION "+KM.www_rc.version_latest+" IS NOW AVALIABLE FOR DOWNLOAD.",document.getElementById("misc_version").style.color=KM.RED)},KM.conf_misc_force_inter=function(){!document.getElementById("misc_low_bw").checked&&!document.getElementById("misc_full").checked?document.getElementById("misc_inter").disabled=!1:(document.getElementById("misc_inter").checked=KM.www_rc.interleave,document.getElementById("misc_inter").disabled=!0),KM.conf_misc_highlight_apply()},KM.conf_misc_save_display=function(){KM.conf_config_track.display_modified(),KM.conf_misc_highlight_apply()},KM.conf_misc_save_pw=function(){KM.config.pwd_changed=!0,KM.conf_config_track.pw_modified(),KM.conf_misc_highlight_apply()},KM.conf_misc_highlight_apply=function(){document.getElementById("conf_apply").style.fontWeight="bold",document.getElementById("conf_apply").style.color=KM.BLUE,document.getElementById("conf_text").style.color=KM.BLUE},KM.conf_misc_apply=function(){KM.www_rc.interleave=document.getElementById("misc_inter").checked,KM.www_rc.full_screen=document.getElementById("misc_full").checked,KM.www_rc.low_bandwidth=document.getElementById("misc_low_bw").checked,KM.www_rc.low_cpu=document.getElementById("misc_low_cpu").checked,KM.www_rc.skip_frames=document.getElementById("misc_skip_frames").checked,KM.www_rc.archive_button_enabled=document.getElementById("misc_archive").checked,KM.www_rc.logs_button_enabled=document.getElementById("misc_logs").checked,KM.www_rc.config_button_enabled=document.getElementById("misc_config").checked,KM.www_rc.func_button_enabled=document.getElementById("misc_func").checked,KM.www_rc.msg_button_enabled=document.getElementById("misc_msg").checked,KM.www_rc.about_button_enabled=document.getElementById("misc_about").checked,KM.www_rc.logout_button_enabled=document.getElementById("misc_logout").checked,KM.www_rc.secure=document.getElementById("misc_secure").checked,KM.config.pwd_changed&&(KM.www_rc.config_hash=KM.config_misc_hash_pw(document.getElementById("misc_pw").value),KM.config.pwd_changed=!1),document.getElementById("misc_save").checked=!1,document.getElementById("conf_apply").style.fontWeight="normal",document.getElementById("conf_apply").style.color=KM.BLACK,document.getElementById("conf_text").style.color=KM.DARK_GREY,KM.update_function_buttons(4),KM.conf_config_track.misc_modified(),KM.conf_config_track.sync()},KM.config_misc_hash_pw=function(a){var b="";for(var c=0;c<a.length;c++)b+=a.charCodeAt(c);return b},KM.conf_feed_html=function(a){var b=340,c=250,d="",e=b/10,f=c/10,g="";for(var h=1;h<101;h++)g+='<div id="mask_'+h+'" style="position:absolute; left:10px; top:10px;">'+'<img id="mask_img_'+h+'" style="width:'+e+"px; height:"+f+'px;"'+'onclick="KM.conf_toggle_feed_mask('+h+');" '+'src="images/mask_trans.png" alt="">'+"</div>";g+='<br><div style="float:left; width:360px;"><div class="margin_left_20px"><img id="image" style="width: '+b+"px; height: "+c+'px;" src="images/gcam.png" alt=""> '+"</div>"+"</div>"+'<div class="config_tick_box">'+'<input type="checkbox" id="feed_enabled" onclick="KM.conf_feed_enabled();">'+"Enable camera"+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div style="float:left; width:75px;" class="config_text disabled margin_top_4px" id="feed_text_1">'+'<span class="margin_top_3px">Device&nbsp;:</span><br>'+'<div class="margin_top_3px"></div>'+"URL&nbsp;:<br>"+'<div class="margin_top_3px"></div>'+"Name&nbsp;:<br>"+'<div class="margin_top_3px"></div>'+"Width&nbsp;:<br>"+"</div>"+'<div style="float:left; width:110px;" class="config_text_basic margin_top_4px">'+'<select id="feed_device" onchange="KM.conf_feed_net_highlight();" disabled>'+'<option value="0">/dev/video0</option>'+'<option value="1">/dev/video1</option>'+'<option value="2">/dev/video2</option>'+'<option value="3">/dev/video3</option>'+'<option value="4">/dev/video4</option>'+'<option value="5">/dev/video5</option>'+'<option value="6">/dev/video6</option>'+'<option value="7">/dev/video7</option>'+'<option value="8">/dev/video8</option>'+'<option value="9">/dev/video9</option>'+'<option value="10">/dev/video10</option>'+'<option value="11">/dev/video11</option>'+'<option value="12">/dev/video12</option>'+'<option value="13">/dev/video13</option>'+'<option value="14">/dev/video14</option>'+'<option value="15">/dev/video15&nbsp;</option>'+'<option value="URL http://">Network Cam</option>'+"</select>"+'<input type="text" id="feed_url" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled>'+'<input type="text" id="feed_lgn_name" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled>'+'<input type="text" id="feed_width" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" px"+"</div>"+'<div style="float:left; width:75px;" class="config_text disabled margin_top_4px" id="feed_text_2">'+"Input&nbsp;:<br>"+'<div class="margin_top_3px"></div>'+"Proxy&nbsp;:<br>"+'<div class="margin_top_3px"></div>'+"Pass&nbsp;:<br>"+'<div class="margin_top_3px"></div>'+"Height&nbsp;:<br>"+"</div>"+'<div style="float:left; width:100px;" class="config_text_basic margin_top_4px">'+'<select id="feed_input" onchange="KM.conf_feed_highlight_apply();" disabled>'+'<option value="0">0</option>'+'<option value="1">1</option>'+'<option value="2">2</option>'+'<option value="3">3</option>'+'<option value="4">4</option>'+'<option value="5">5</option>'+'<option value="6">6</option>'+'<option value="7">7</option>'+'<option value="8">-&nbsp;&nbsp;</option>'+"</select><br>"+'<input type="text" id="feed_proxy" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled>'+'<input type="password" id="feed_lgn_pw" style="width: 120px; height: 15px;" onfocus="KM.conf_feed_highlight_apply();" disabled>'+'<input type="text" id="feed_height" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" px"+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_button disabled margin_top_4px" id="feed_text_3">'+' Camera name : " '+a+" : "+'<input type="text" id="feed_name" size="15" onfocus="KM.conf_feed_highlight_apply();" disabled>'+' "'+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="feed_text_4">'+'<input type="checkbox" id="feed_box" onclick="KM.conf_feed_highlight_apply();" disabled>'+"Enable motion highlighting (Draw box)"+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_button disabled margin_top_4px" id="feed_text_5">'+"Click on the image to edit the motion mask."+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_button disabled margin_top_4px" id="feed_text_6">'+"Record : "+'<input type="text" id="feed_fps" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" fps, &nbsp;&nbsp;Image (frame & snap) quality : "+'<input type="text" id="feed_quality" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" %, &nbsp;&nbsp;Movie quality : "+'<input type="text" id="feed_kbs" size="4" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" kbs"+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="feed_text_7">'+'<input type="checkbox" id="feed_frame_enabled" onclick="KM.conf_feed_frame_selected();" disabled>'+"Enable frame mode. Record motion events as a series of discrete frames."+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="feed_text_8">'+'<input type="checkbox" id="feed_ffmpeg_enabled" onclick="KM.conf_feed_ffmpeg_selected();" disabled>'+"Enable movie mode. Record motion events as a (flash swf) movie."+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="feed_text_9">'+'<input type="checkbox" id="feed_updates" onclick="KM.conf_feed_highlight_apply();" disabled>'+"Enable additional live image updates. May increases server load."+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="feed_text_10">'+'<input type="checkbox" id="feed_snap_enabled" onclick="KM.conf_feed_highlight_apply();" disabled>'+"Enable snapshot mode. Record an image in time lapse mode with a pause between images<br>&nbsp;of : "+'<input type="text" id="feed_snap" size="6" onfocus="KM.conf_feed_highlight_apply();" disabled>'+" Seconds (300 Seconds recommended)"+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_button margin_top_4px" id="feed_text_11">'+'<input type="button" id="feed_apply" OnClick="KM.conf_feed_apply();" value="Apply"> '+"all changes to the local browser configuration and sync with the remote server."+"</div>",KM.www_rc.feed_enabled[KM.config.camera]&&(g=g.replace(/disabled/g,""),g=g.replace(/gcam.png/,"bcam.png"),KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera)),document.getElementById("config_html").innerHTML=g,KM.www_rc.feed_enabled[KM.config.camera]&&(KM.www_rc.feed_device[KM.config.camera]==16?(document.getElementById("feed_input").disabled=!0,document.getElementById("feed_url").disabled=!1,document.getElementById("feed_proxy").disabled=!1,document.getElementById("feed_lgn_name").disabled=!1,document.getElementById("feed_lgn_pw").disabled=!1):(document.getElementById("feed_input").disabled=!1,document.getElementById("feed_url").disabled=!0,document.getElementById("feed_proxy").disabled=!0,document.getElementById("feed_lgn_name").disabled=!0,document.getElementById("feed_lgn_pw").disabled=!0)),document.getElementById("feed_enabled").checked=KM.www_rc.feed_enabled[KM.config.camera],document.getElementById("feed_device").selectedIndex=KM.www_rc.feed_device[KM.config.camera],document.getElementById("feed_input").selectedIndex=KM.www_rc.feed_input[KM.config.camera],document.getElementById("feed_url").value=KM.www_rc.feed_url[KM.config.camera],document.getElementById("feed_proxy").value=KM.www_rc.feed_proxy[KM.config.camera],document.getElementById("feed_lgn_name").value=KM.www_rc.feed_lgn_name[KM.config.camera],document.getElementById("feed_lgn_pw").value=KM.www_rc.feed_lgn_pw[KM.config.camera],document.getElementById("feed_width").value=KM.www_rc.feed_width[KM.config.camera],document.getElementById("feed_height").value=KM.www_rc.feed_height[KM.config.camera],document.getElementById("feed_name").value=KM.www_rc.feed_name[KM.config.camera],document.getElementById("feed_box").checked=KM.www_rc.feed_show_box[KM.config.camera],document.getElementById("feed_fps").value=KM.www_rc.feed_fps[KM.config.camera],document.getElementById("feed_quality").value=KM.www_rc.feed_quality[KM.config.camera],document.getElementById("feed_kbs").value=KM.www_rc.feed_kbs[KM.config.camera],document.getElementById("feed_snap_enabled").checked=KM.www_rc.feed_snap_enabled[KM.config.camera],document.getElementById("feed_snap").value=KM.www_rc.feed_snap_interval[KM.config.camera],document.getElementById("feed_frame_enabled").checked=KM.www_rc.feed_smovie_enabled[KM.config.camera],document.getElementById("feed_ffmpeg_enabled").checked=KM.www_rc.feed_movie_enabled[KM.config.camera],document.getElementById("feed_updates").checked=KM.www_rc.feed_updates[KM.config.camera];var i=document.getElementById("image").offsetTop,j=document.getElementById("image").offsetLeft,k=0;KM.browser.browser_OP&&(k=-2),KM.browser.browser_IE&&(k=-2),j+=k,i+=k;var l=0;for(var m=0;m<10;m++)for(var n=0;n<10;n++)l=n+1+m*10,document.getElementById("mask_"+l).style.top=i+f*m+"px",document.getElementById("mask_"+l).style.left=j+e*n+"px";KM.config.mask="";var o=KM.www_rc.feed_mask[KM.config.camera].split("#");for(var h=0;h<10;h++)KM.config.mask+=KM.pad_out(parseInt(o[h],16).toString(2),10);if(KM.www_rc.feed_enabled[KM.config.camera]){for(var h=0;h<100;h++)KM.config.mask.charAt(h)==="1"&&(document.getElementById("mask_img_"+(h+1)).src="images/mask.png");document.getElementById("ptz_button").disabled=!1}},KM.conf_feed_enabled=function(){KM.conf_feed_highlight_apply(),document.getElementById("feed_enabled").checked?KM.conf_feed_ungrey():KM.conf_feed_grey(),KM.conf_config_track.mask_modified(KM.config.camera)},KM.conf_toggle_feed_mask=function(a){KM.config.mask.charAt(a-1)==="0"&&document.getElementById("feed_enabled").checked?(document.getElementById("mask_img_"+a).src="images/mask.png",KM.config.mask=KM.config.mask.substr(0,a-1)+"1"+KM.config.mask.substr(a)):(document.getElementById("mask_img_"+a).src="images/mask_trans.png",KM.config.mask=KM.config.mask.substr(0,a-1)+"0"+KM.config.mask.substr(a)),KM.conf_config_track.mask_modified(KM.config.camera),KM.conf_feed_highlight_apply()},KM.conf_feed_net_highlight=function(){document.getElementById("feed_device").selectedIndex==16?(document.getElementById("feed_input").disabled=!0,document.getElementById("feed_url").disabled=!1,document.getElementById("feed_proxy").disabled=!1,document.getElementById("feed_lgn_name").disabled=!1,document.getElementById("feed_lgn_pw").disabled=!1):(document.getElementById("feed_input").disabled=!1,document.getElementById("feed_url").disabled=!0,document.getElementById("feed_proxy").disabled=!0,document.getElementById("feed_lgn_name").disabled=!0,document.getElementById("feed_lgn_pw").disabled=!0,KM.conf_feed_highlight_apply())},KM.conf_feed_frame_selected=function(){document.getElementById("feed_ffmpeg_enabled").checked=!1,KM.conf_feed_highlight_apply()},KM.conf_feed_ffmpeg_selected=function(){document.getElementById("feed_frame_enabled").checked=!1,KM.conf_feed_highlight_apply()},KM.conf_feed_grey=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current);var a=["feed_device","feed_input","feed_url","feed_proxy","feed_lgn_name","feed_lgn_pw","feed_width","feed_height","feed_name","feed_box","feed_fps","feed_quality","feed_kbs","feed_snap_enabled","feed_snap","feed_frame_enabled","feed_ffmpeg_enabled","feed_updates"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!0;for(var b=1;b<11;b++)document.getElementById("feed_text_"+b).style.color=KM.GHOST;for(var b=0;b<100;b++)document.getElementById("mask_img_"+(b+1)).src="images/mask_trans.png";document.getElementById("image").src="images/gcam.png"},KM.conf_feed_ungrey=function(){KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera);var a=["feed_device","feed_input","feed_url","feed_proxy","feed_lgn_name","feed_lgn_pw","feed_width","feed_height","feed_name","feed_box","feed_fps","feed_quality","feed_kbs","feed_snap_enabled","feed_snap","feed_frame_enabled","feed_ffmpeg_enabled","feed_updates"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!1;for(var b=1;b<11;b++)document.getElementById("feed_text_"+b).style.color=KM.DARK_GREY;KM.conf_feed_net_highlight(),document.getElementById("image").src="images/bcam.png";for(var b=0;b<100;b++)KM.config.mask.charAt(b)==="1"&&(document.getElementById("mask_img_"+(b+1)).src="images/mask.png")},KM.conf_feed_highlight_apply=function(){document.getElementById("feed_apply").style.fontWeight="bold",document.getElementById("feed_apply").style.color=KM.BLUE,document.getElementById("feed_text_11").style.color=KM.BLUE},KM.conf_feed_apply=function(){KM.www_rc.feed_enabled[KM.config.camera]=document.getElementById("feed_enabled").checked,KM.www_rc.feed_device[KM.config.camera]=document.getElementById("feed_device").selectedIndex,KM.www_rc.feed_input[KM.config.camera]=document.getElementById("feed_input").selectedIndex,KM.www_rc.feed_url[KM.config.camera]=document.getElementById("feed_url").value,KM.www_rc.feed_proxy[KM.config.camera]=document.getElementById("feed_proxy").value,KM.www_rc.feed_lgn_name[KM.config.camera]=document.getElementById("feed_lgn_name").value,KM.www_rc.feed_lgn_pw[KM.config.camera]=document.getElementById("feed_lgn_pw").value,KM.www_rc.feed_name[KM.config.camera]=document.getElementById("feed_name").value,KM.www_rc.feed_show_box[KM.config.camera]=document.getElementById("feed_box").checked,KM.www_rc.feed_snap_enabled[KM.config.camera]=document.getElementById("feed_snap_enabled").checked,KM.www_rc.feed_smovie_enabled[KM.config.camera]=document.getElementById("feed_frame_enabled").checked,KM.www_rc.feed_movie_enabled[KM.config.camera]=document.getElementById("feed_ffmpeg_enabled").checked,KM.www_rc.feed_updates[KM.config.camera]=document.getElementById("feed_updates").checked;var a="";KM.www_rc.feed_mask[KM.config.camera]="";for(var b=0;b<10;b++)a=KM.config.mask.substr(b*10,10),KM.www_rc.feed_mask[KM.config.camera]+=parseInt(a,2).toString(16)+"#";var c=parseInt(document.getElementById("feed_width").value,10);isNaN(c)&&(c=0),c=parseInt(c/16)*16,KM.www_rc.feed_width[KM.config.camera]!==c&&(KM.conf_config_track.mask_modified(KM.config.camera),KM.www_rc.feed_width[KM.config.camera]=c),document.getElementById("feed_width").value=c;var d=parseInt(document.getElementById("feed_height").value,10);isNaN(d)&&(d=0),d=parseInt(d/16)*16,KM.www_rc.feed_height[KM.config.camera]!==d&&(KM.conf_config_track.mask_modified(KM.config.camera),KM.www_rc.feed_height[KM.config.camera]=d),document.getElementById("feed_height").value=d;var e=parseInt(document.getElementById("feed_fps").value,10);isNaN(e)&&(e=0),KM.www_rc.feed_fps[KM.config.camera]=e,document.getElementById("feed_fps").value=e;var f=parseInt(document.getElementById("feed_quality").value,10);isNaN(f)&&(f=10),f=Math.max(10,f),f=Math.min(100,f),KM.www_rc.feed_quality[KM.config.camera]=f,document.getElementById("feed_quality").value=f;var g=parseInt(document.getElementById("feed_kbs").value,10);isNaN(g)&&(g=0),KM.www_rc.feed_kbs[KM.config.camera]=g,document.getElementById("feed_kbs").value=g;var h=parseInt(document.getElementById("feed_snap").value,10);isNaN(h)&&(h=0),KM.www_rc.feed_snap_interval[KM.config.camera]=h,document.getElementById("feed_snap").value=h,KM.www_rc.feed_enabled[KM.config.camera]?document.getElementById("ptz_button").disabled=!1:document.getElementById("ptz_button").disabled=!0,document.getElementById("feed_apply").style.fontWeight="normal",document.getElementById("feed_apply").style.color=KM.BLACK,document.getElementById("feed_text_11").style.color=KM.DARK_GREY,KM.conf_config_track.feed_modified(KM.config.camera),KM.conf_config_track.sync()},KM.conf_live_feed_daemon=function(a,b){function h(){c===KM.session_id.current&&(e=(new Date).getTime(),KM.kill_timeout_ids(KM.CONFIG_LOOP),KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){KM.get_jpeg(d,i,c)},1)))}function i(a,b,c,d){if(d===KM.session_id.current){KM.update_feeds(),a!=="null"&&(g++,g=g>4?0:g,f[g]=a,document.getElementById("image").src=f[g]);var i=(new Date).getTime()-e,j=Math.max(0,500-i);KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){h()},j))}}var c=a,d=b,e=0,f=["","","","",""],g=0;KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){h()},1))},KM.conf_ptz_html=function(){KM.config.session_id=KM.session_id.current,KM.conf_config_track.reset();var a=340,b=250,c='<br><div style="float:left; width:360px;"><div class="margin_left_20px"><img id="image" style="width: '+a+"px; height: "+b+'px;" src="images/gcam.png" alt=""> '+'<input type="button" id="ptz_left" style="width:85px;" '+'OnClick="KM.conf_ptz_servo(1);" value="Left" disabled>'+'<input type="button" id="ptz_up" style="width:85px;" '+'OnClick="KM.conf_ptz_servo(2);" value="Up" disabled>'+'<input type="button" id="ptz_down" style="width:85px;" '+'OnClick="KM.conf_ptz_servo(3);" value="Down" disabled>'+'<input type="button" id="ptz_right" style="width:85px;" '+'OnClick="KM.conf_ptz_servo(4);" value="Right" disabled>'+"</div>"+"</div>"+'<div class="config_tick_box">'+'<input type="checkbox" id="ptz_enabled" onclick="KM.conf_ptz_enabled();">'+"Enable PT(Z) mode. (Must be supported)"+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_button disabled margin_top_4px" id="ptz_text_1">'+"Driver : "+'<select id="ptz_track" onchange="KM.conf_ptz_highlight_apply();" disabled>'+'<option value="1">1: stepper (motion tracking project)'+"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</option>"+'<option value="2">2: iomojo for the smilecam</option>'+'<option value="3">3: pwc driver for USB cameras</option>'+'<option value="4">4: generic </option>'+'<option value="5">5: uvcvideo driver for USB cameras</option>'+'<option value="6">6: reserved</option>'+'<option value="7">7: reserved</option>'+'<option value="8">8: reserved</option>'+'<option value="9">9: kmotion Axis 213 driver</option>'+'<option value="10">10: kmotion Axis 2130 driver</option>'+'<option value="11">11: kmotion Panasonic driver</option>'+'<option value="12">12: kmotion Foscam driver</option>'+"</select>"+"</div><br>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="ptz_text_2">'+'<input type="checkbox" id="ptz_calib_first" onclick="KM.conf_ptz_highlight_apply();" disabled>'+"Auto recalibrate. (Causes addition pan / tilting)"+"</div>"+'<div style="float:left; width:120px;" class="config_button disabled margin_top_4px" id="ptz_text_3">'+"Steps Click X :<br>"+"Button Delay :<br>"+"</div>"+'<div class="margin_top_4px">'+'<input type="text" id="ptz_step_x" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;'+'<span class="config_text_basic disabled" id="ptz_text_4">'+"&nbsp;&nbsp;&nbsp;Steps Click Y :&nbsp;&nbsp;"+'<input type="text" id="ptz_step_y" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;<br>'+"</span>"+'<input type="text" id="ptz_servo_settle" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>'+"</div>"+'<div class="divider">'+'<img src="images/config_divider.png" alt="" >'+"</div>"+'<div class="config_button disabled margin_top_4px" id="ptz_text_5">'+"Always "+'<input type="button" id="ptz_calib"         OnClick="KM.conf_ptz_calibrate();" value="Calibrate PT(Z) to X0:Y0" disabled> '+" before moving<br>the camera and selecting any 'Set Position's."+"<br><br>"+"Failure to do so may cause inaccurate positional<br>data to be stored."+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_tick_box disabled margin_top_4px" id="ptz_text_6">'+'<input type="checkbox" id="ptz_park_enabled" onclick="KM.conf_ptz_highlight_apply();" disabled>'+"Enable auto park. Moves the camera to a set position if no activity for a preset time."+"</div>"+'<div class="config_button disabled margin_top_4px" id="ptz_text_7">'+'<input type="button" id="ptz_park_1" OnClick="KM.conf_ptz_set_park();" value="Set Position" disabled>'+'<input type="button" id="ptz_park_2" OnClick="KM.conf_ptz_test_park();" value="Test" disabled>'+" Auto park seconds : "+'<input type="text" id="ptz_park_delay" size="3" onfocus="KM.conf_ptz_highlight_apply();" disabled>&nbsp;'+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="margin_top_4px">'+'<div class="config_button disabled" id="ptz_text_8">'+'<input type="button" id="ptz_preset_1" OnClick="KM.conf_ptz_set_preset(1);" value="Set Position" disabled>'+'<input type="button" id="ptz_preset_2" OnClick="KM.conf_ptz_test_preset(1);" value="Test" disabled>'+" Preset 1: Activated by executing 'kmotion_ptz "+KM.config.camera+" 1' in a BASH shell."+"</div>"+'<div class="config_button disabled" id="ptz_text_9">'+'<input type="button" id="ptz_preset_3" OnClick="KM.conf_ptz_set_preset(2);" value="Set Position" disabled>'+'<input type="button" id="ptz_preset_4" OnClick="KM.conf_ptz_test_preset(2);" value="Test" disabled>'+" Preset 2: Activated by executing 'kmotion_ptz "+KM.config.camera+" 2' in a BASH shell."+"</div>"+'<div class="config_button disabled" id="ptz_text_10">'+'<input type="button" id="ptz_preset_5" OnClick="KM.conf_ptz_set_preset(3);" value="Set Position" disabled>'+'<input type="button" id="ptz_preset_6" OnClick="KM.conf_ptz_test_preset(3);" value="Test" disabled >'+" Preset 3: Activated by executing 'kmotion_ptz "+KM.config.camera+" 3' in a BASH shell."+"</div>"+'<div class="config_button disabled" id="ptz_text_11">'+'<input type="button" id="ptz_preset_7" OnClick="KM.conf_ptz_set_preset(4);" value="Set Position" disabled>'+'<input type="button" id="ptz_preset_8" OnClick="KM.conf_ptz_test_preset(4);" value="Test" disabled>'+" Preset 4: Activated by executing 'kmotion_ptz "+KM.config.camera+" 4' in a BASH shell."+"</div>"+"</div>"+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div class="config_button margin_top_4px" id="ptz_text_12">'+'<input type="button" id="ptz_apply" OnClick="KM.conf_ptz_apply();" value="Apply"> '+"all changes to the local browser configuration and sync with the remote server."+"</div>";KM.www_rc.ptz_enabled[KM.config.camera]&&(c=c.replace(/disabled/g,""),c=c.replace(/gcam.png/,"bcam.png"),KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera)),document.getElementById("config_html").innerHTML=c,document.getElementById("ptz_enabled").checked=KM.www_rc.ptz_enabled[KM.config.camera],document.getElementById("ptz_track").selectedIndex=KM.www_rc.ptz_track_type[KM.config.camera]-1,document.getElementById("ptz_calib_first").checked=KM.www_rc.ptz_calib_first[KM.config.camera],document.getElementById("ptz_step_x").value=KM.www_rc.ptz_step_x[KM.config.camera],document.getElementById("ptz_step_y").value=KM.www_rc.ptz_step_y[KM.config.camera],document.getElementById("ptz_servo_settle").value=KM.www_rc.ptz_servo_settle[KM.config.camera],document.getElementById("ptz_park_enabled").checked=KM.www_rc.ptz_park_enabled[KM.config.camera],document.getElementById("ptz_park_delay").value=KM.www_rc.ptz_park_delay[KM.config.camera],KM.config.ptz_alert_status_1=!1},KM.conf_ptz_servo=function(a){KM.exe_script("cgi_bin/xmlHttp_ptz.py","crf"+KM.pad_out2(KM.config.camera)+"b"+KM.pad_out2(a)+"$"),KM.conf_ptz_grey_LUDR(),a===1?KM.config.ptz_current_x-=KM.www_rc.ptz_step_x[KM.config.camera]:a===2?KM.config.ptz_current_y+=KM.www_rc.ptz_step_y[KM.config.camera]:a===3?KM.config.ptz_current_y-=KM.www_rc.ptz_step_y[KM.config.camera]:KM.config.ptz_current_x+=KM.www_rc.ptz_step_x[KM.config.camera]},KM.conf_ptz_calibrate=function(){KM.conf_ptz_grey_LUDR(),KM.exe_script("cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x5000y5000$"),KM.config.ptz_current_x=0,KM.config.ptz_current_y=0},KM.conf_ptz_set_park=function(){KM.www_rc.ptz_park_x[KM.config.camera]=KM.config.ptz_current_x,KM.www_rc.ptz_park_y[KM.config.camera]=KM.config.ptz_current_y,KM.conf_ptz_highlight_apply()},KM.conf_ptz_test_park=function(){KM.conf_ptz_grey_LUDR(),KM.config.ptz_current_x=KM.www_rc.ptz_park_x[KM.config.camera],KM.config.ptz_current_y=KM.www_rc.ptz_park_y[KM.config.camera],KM.exe_script("cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x"+KM.pad_out4(KM.www_rc.ptz_park_x[KM.config.camera]+5e3)+"y"+KM.pad_out4(KM.www_rc.ptz_park_y[KM.config.camera]+5e3)+"$")},KM.conf_ptz_set_preset=function(a){KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera]=KM.config.ptz_current_x,KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera]=KM.config.ptz_current_y,KM.conf_ptz_highlight_apply()},KM.conf_ptz_test_preset=function(a){KM.conf_ptz_grey_LUDR(),KM.config.ptz_current_x=KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera],KM.config.ptz_current_y=KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera],KM.exe_script("cgi_bin/xmlHttp_ptz.py","caf"+KM.pad_out2(KM.config.camera)+"x"+KM.pad_out4(KM.www_rc["ptz_preset"+a+"_x"][KM.config.camera]+5e3)+"y"+KM.pad_out4(KM.www_rc["ptz_preset"+a+"_y"][KM.config.camera]+5e3)+"$")},KM.conf_ptz_enabled=function(){KM.conf_config_track.ptz_en_tt_modified(KM.config.camera),KM.conf_ptz_highlight_apply(),document.getElementById("ptz_enabled").checked?KM.conf_ptz_ungrey():KM.conf_ptz_grey()},KM.conf_ptz_highlight_apply=function(){document.getElementById("ptz_apply").style.fontWeight="bold",document.getElementById("ptz_apply").style.color=KM.BLUE,document.getElementById("ptz_text_12").style.color=KM.BLUE},KM.conf_ptz_grey=function(){KM.session_id.current++,KM.conf_error_daemon(KM.session_id.current),KM.conf_ptz_grey_LUDR();var a=["ptz_track","ptz_calib_first","ptz_step_x","ptz_step_y","ptz_servo_settle","ptz_calib","ptz_park_enabled","ptz_park_delay","ptz_park_1","ptz_park_2","ptz_preset_1","ptz_preset_2","ptz_preset_3","ptz_preset_4","ptz_preset_5","ptz_preset_6","ptz_preset_7","ptz_preset_8"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!0;for(var b=1;b<12;b++)document.getElementById("ptz_text_"+b).style.color=KM.GHOST;document.getElementById("image").src="images/gcam.png"},KM.conf_ptz_grey_LUDR=function(){var a=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!0},KM.conf_ptz_ungrey=function(){KM.conf_live_feed_daemon(KM.session_id.current,KM.config.camera);var a=["ptz_track","ptz_calib_first","ptz_step_x","ptz_step_y","ptz_servo_settle","ptz_calib","ptz_park_enabled","ptz_park_delay","ptz_park_1","ptz_park_2","ptz_preset_1","ptz_preset_2","ptz_preset_3","ptz_preset_4","ptz_preset_5","ptz_preset_6","ptz_preset_7","ptz_preset_8"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!1;var a=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!1;for(var b=1;b<12;b++)document.getElementById("ptz_text_"+b).style.color=KM.DARK_GREY;document.getElementById("image").src="images/bcam.png"},KM.conf_ptz_ungrey_LUDR=function(){if(KM.www_rc.ptz_enabled[KM.config.camera]&&KM.config.session_id===KM.session_id.current){var a=["ptz_left","ptz_up","ptz_down","ptz_right"];for(var b=0;b<a.length;b++)document.getElementById(a[b]).disabled=!1}},KM.conf_ptz_apply=function(){KM.www_rc.ptz_enabled[KM.config.camera]=document.getElementById("ptz_enabled").checked,KM.www_rc.ptz_calib_first[KM.config.camera]=document.getElementById("ptz_calib_first").checked,KM.www_rc.ptz_servo_settle[KM.config.camera]=document.getElementById("ptz_servo_settle").value,KM.www_rc.ptz_park_enabled[KM.config.camera]=document.getElementById("ptz_park_enabled").checked;if(KM.www_rc.ptz_step_x[KM.config.camera]!==parseInt(document.getElementById("ptz_step_x").value,10)||KM.www_rc.ptz_step_y[KM.config.camera]!==parseInt(document.getElementById("ptz_step_y").value,10)){var a=parseInt(document.getElementById("ptz_step_x").value,10),b=parseInt(document.getElementById("ptz_step_y").value,10);isNaN(a)&&(a=0),isNaN(b)&&(b=0),KM.www_rc.ptz_step_x[KM.config.camera]=a,KM.www_rc.ptz_step_y[KM.config.camera]=b,document.getElementById("ptz_step_x").value=a,document.getElementById("ptz_step_y").value=b}KM.www_rc.ptz_track_type[KM.config.camera]!==parseInt(document.getElementById("ptz_track").value,10)&&(KM.www_rc.ptz_track_type[KM.config.camera]=document.getElementById("ptz_track").value,KM.conf_config_track.ptz_en_tt_modified(KM.config.camera));var c=parseFloat(document.getElementById("ptz_servo_settle").value,10);isNaN(c)&&(c=0),KM.www_rc.ptz_servo_settle[KM.config.camera]=c,document.getElementById("ptz_servo_settle").value=c;var d=parseInt(document.getElementById("ptz_park_delay").value,10);isNaN(d)&&(d=0),KM.www_rc.ptz_park_delay[KM.config.camera]=d,document.getElementById("ptz_park_delay").value=d,document.getElementById("ptz_apply").style.fontWeight="normal",document.getElementById("ptz_apply").style.color=KM.BLACK,document.getElementById("ptz_text_12").style.color=KM.DARK_GREY,KM.conf_config_track.ptz_misc_modified(KM.config.camera),KM.conf_config_track.sync()},KM.conf_error_html=function(){document.getElementById("config_html").innerHTML='<br><div id="error_text" class="config_error_block"></div>';var a=KM.config.error_str.split("\n");for(var b=0;b<a.length;b++)a[b].search(KM.config.error_search_str)!==-1&&(a[b]='<span style="color:'+KM.RED+';">'+a[b]+"</span>");var c=a.join("<br>");document.getElementById("error_text").innerHTML=c},KM.conf_load_html=function(){function c(a,b){return KM.browser.browser_IE?'<div class="bar_bground margin_top_4px"><div id="bar_fground'+b+'" class="bar_fground">'+"</div>"+'<span id="bar_text'+b+'" class="bar_text_IE">'+a+"</span>"+'<span id="bar_value'+b+'" class="bar_text_IE">'+"</span>"+"</div>":'<div class="bar_bground  margin_top_4px"><span id="bar_text'+b+'" class="bar_text">'+a+"</span>"+'<span id="bar_value'+b+'" class="bar_value">'+"</span>"+'<div id="bar_fground'+b+'" class="bar_fground">'+"</div>"+"</div>"}function d(a){var b={},c=a.split("$");for(var d=1;d<c.length;d++){var g=c[d].substr(0,2);g==="bx"||g==="sr"||g==="up"?b[g]=c[d].substr(3):b[g]=parseFloat(c[d].substr(3),10)}e(b),f(b)}function e(a){document.getElementById("server_info").innerHTML=a.bx+" "+a.sr+" Uptime "+a.up,document.getElementById("memory_title").innerHTML="Memory "+a.mt+"k",document.getElementById("swap_title").innerHTML="Swap "+a.st+"k"}function f(a){document.getElementById("bar_value1").innerHTML=a.l1;var c=Math.min(a.l1,1.5);document.getElementById("bar_fground1").style.width=c*(b/1.5)+"px",document.getElementById("bar_value2").innerHTML=a.l2,c=Math.min(a.l2,1.5),document.getElementById("bar_fground2").style.width=c*(b/1.5)+"px",c>=1?document.getElementById("bar_fground2").style.backgroundColor=KM.RED:document.getElementById("bar_fground2").style.backgroundColor=KM.BAR,document.getElementById("bar_value3").innerHTML=a.l3,c=Math.min(a.l3,1.5),document.getElementById("bar_fground3").style.width=c*(b/1.5)+"px",c>=1?document.getElementById("bar_fground3").style.backgroundColor=KM.RED:document.getElementById("bar_fground3").style.backgroundColor=KM.BAR,document.getElementById("bar_value4").innerHTML=a.cu+"%",c=a.cu/100*b,document.getElementById("bar_fground4").style.width=c+"px",document.getElementById("bar_value5").innerHTML=a.cs+"%",c=a.cs/100*b,document.getElementById("bar_fground5").style.width=c+"px",document.getElementById("bar_value6").innerHTML=a.ci+"%",c=a.ci/100*b,document.getElementById("bar_fground6").style.width=c+"px";var d=a.mf+a.mb+a.mc,e=a.mt-d;document.getElementById("bar_value7").innerHTML=e+"k",c=e/a.mt*b,document.getElementById("bar_fground7").style.width=c+"px",document.getElementById("bar_value8").innerHTML=a.mb+"k",c=a.mb/a.mt*b,document.getElementById("bar_fground8").style.width=c+"px",document.getElementById("bar_value9").innerHTML=a.mc+"k",c=a.mc/a.mt*b,document.getElementById("bar_fground9").style.width=c+"px",document.getElementById("bar_value10").innerHTML=a.su+"k",a.st=Math.max(a.st,1),c=a.su/a.st,document.getElementById("bar_fground10").style.width=c*b+"px",c>=.1?document.getElementById("bar_fground10").style.backgroundColor=KM.RED:document.getElementById("bar_fground10").style.backgroundColor=KM.BAR}function g(){function b(){var b=KM.get_xmlHttp_obj();b.onreadystatechange=function(){if(b.readyState===4){b.onreadystatechange=null;var c=b.responseText;parseInt(c.substr(c.length-4),10)===c.length-8&&KM.session_id.current===a&&d(c)}},b.open("GET","cgi_bin/xmlHttp_load.py?rnd="+(new Date).getTime(),!0),b.send(null)}function c(){b(),KM.session_id.current===a&&KM.add_timeout_id(KM.CONFIG_LOOP,setTimeout(function(){c()},2e3))}c()}var a=KM.session_id.current,b=750;document.getElementById("config_html").innerHTML='<br><div id="server_info" class="config_text_center">Please wait - Downloading server data.</div><div class="divider"><img src="images/config_divider_xl.png" alt="" ></div><div id="load_av_title" class="config_text_center">Load Averages</div>'+c("1 min",1)+c("5 min",2)+c("15 min",3)+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div id="cpu_title" class="config_text_center">'+"Central Processing Unit"+"</div>"+c("User",4)+c("System",5)+c("IO Wait",6)+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div id="memory_title" class="config_text_center">'+"Memory"+"</div>"+c("System",7)+c("Buffered",8)+c("Cached",9)+'<div class="divider">'+'<img src="images/config_divider_xl.png" alt="" >'+"</div>"+'<div id="swap_title" class="config_text_center">'+"Swap"+"</div>"+c("Swap",10),g()},KM.display_about=function(){KM.session_id.current++;var a="title_FF";KM.browser.browser_OP&&(a="title_OP"),KM.browser.browser_IE&&(a="title_IE"),document.getElementById("main_display").innerHTML='<div id="'+a+'">'+'<span class="italic">kmotion</span>: About'+"</div>"+'<div class="divider">'+'<img src="images/divider_xl.png" alt="" />'+"</div>"+'<div class="para_msg">'+"<p>My name is Dave Selby the developer of kmotion and "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://code.google.com/p/kmotion2');\">kmotion v2</span>"+". This is my pet project which I develop in my spare time. "+"Unfortunately I don't work in the IT industry but if you email me at "+"dave6502@googlemail.com I will send you my CV ;)</p>"+"<p>On a personal note I would like to thank "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://picasaweb.google.com/jazzcommunication');\">Gudy</span>"+" for his many many hours of "+"testing and bug reporting on the 'live' code. kmotion v2 would not be where it is now without "+"his help - thank you Gudy.</p>"+"<p>I would also like to thank "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://www.prunk.si');\">Jan Prunk </span>"+"for providing the "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://www.kmotion.eu');\">'www.kmotion.eu' </span>"+"domain, website and blog all without charge allowing kmotion to move "+"to the next level - thank you Jan.</p>"+"<p>And I would like to thank "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://www.wingware.com/');\">Wingware</span> "+"for supplying a copy of their superb Python IDE without which this "+"project would have taken much much longer. It has also proven itself "+"as an excellent Javascript, BASH, HTML and CSS editor!</p>"+"<p>Lastly if you like the software please feel free to drop me some $ "+"via paypal to the above address. Failing that if you are as poor as "+"me, do me a favour and send me a screenshot of your site. If you "+"give permission I will paste it on the site. Enjoy.</p>"+"<p>Released under the "+'<span class="link_word" onClick="javascript: '+"KM.about_link_to('http://www.gnu.org/licenses/gpl.html');\">GPL v3.</span></p>"+"</div>"},KM.about_link_to=function(a){document.getElementById("main_display").innerHTML='<object data="'+a+'" type="text/html"'+'width="100%" height="100%"'+"</object>"},KM.display_msg=function(){KM.session_id.current++;if(KM.www_rc.msg.length<5){var a="title_FF";KM.browser.browser_OP&&(a="title_OP"),KM.browser.browser_IE&&(a="title_IE"),document.getElementById("main_display").innerHTML='<div id="'+a+'">',document.getElementById("main_display").innerHTML='<div id="'+a+'">'+'<span class="italic">kmotion</span>: Msg'+"</div>"+'<div class="divider">'+'<img src="images/divider_xl.png" alt="" />'+"</div>"+'<div class="para_msg"><p style="text-align: center">No Messages ...</p></div>'}else document.getElementById("main_display").innerHTML='<div class="para_msg">'+KM.collapse_chars(KM.www_rc.msg)+"</div>"},KM.init1=function(){KM.feed_cache_setup(),KM.update_feeds();var a=KM.init2;KM.load_settings(a)},KM.init2=function(a){function b(){KM.background_button_clicked(KM.www_rc.color_select),KM.enable_display_buttons(KM.www_rc.display_select),KM.enable_camera_buttons(),KM.www_rc.msg.length<5?(KM.enable_function_buttons(1),KM.function_button_clicked(1)):(KM.enable_function_buttons(7),KM.function_button_clicked(7))}KM.add_timeout_id(KM.DISPLAY_LOOP,setTimeout(function(){b()},1e3))},KM.init1();